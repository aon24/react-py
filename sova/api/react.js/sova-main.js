(this["webpackJsonpsova-online"]=this["webpackJsonpsova-online"]||[]).push([[0],[,,,,,,,,,,,,function(e,t,a){e.exports=a(23)},,,,,,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){"use strict";a.r(t);var s,n=a(1),r=a(4),i=a(3),o=a(5),l=a(6),c=a(0),u=a.n(c),d=a(11),p=a.n(d),h=a(9),f=a(7),m=a(2),v=a(8),y=a.n(v),b=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",s=t?u.a.createElement("div",{className:"spinner"}):u.a.createElement("div",{className:"preloader "+a},u.a.createElement("div",null),u.a.createElement("div",null),u.a.createElement("div",null),u.a.createElement("div",null),u.a.createElement("div",null),u.a.createElement("div",null),u.a.createElement("div",null),u.a.createElement("div",null),u.a.createElement("div",null),u.a.createElement("div",null));return e?u.a.createElement("div",{className:"spinner-wrap"},s):s},g=function(e){if(window.navigator){var t=/iPhone/i,a=/iPod/i,s=/iPad/i,n=/\bAndroid(?:.+)Mobile\b/i,r=/Android/i,i=/\bAndroid(?:.+)SD4930UR\b/i,o=/\bAndroid(?:.+)(?:KF[A-Z]{2,4})\b/i,l=/Windows Phone/i,c=/\bWindows(?:.+)ARM\b/i,u=/BlackBerry/i,d=/BB10/i,p=/Opera Mini/i,h=/\b(CriOS|Chrome)(?:.+)Mobile/i,f=/Mobile(?:.+)Firefox\b/i,m=function(e,t){return e.test(t)},v=navigator.userAgent,y=v.split("[FBAN");y[1]&&(v=y[0]),(y=v.split("Twitter"))[1]&&(v=y[0]);var b={apple:{phone:m(t,v)&&!m(l,v),ipod:m(a,v),tablet:!m(t,v)&&m(s,v)&&!m(l,v),device:(m(t,v)||m(a,v)||m(s,v))&&!m(l,v)},amazon:{phone:m(i,v),tablet:!m(i,v)&&m(o,v),device:m(i,v)||m(o,v)},android:{phone:!m(l,v)&&m(i,v)||!m(l,v)&&m(n,v),tablet:!m(l,v)&&!m(i,v)&&!m(n,v)&&(m(o,v)||m(r,v)),device:!m(l,v)&&(m(i,v)||m(o,v)||m(n,v)||m(r,v))},windows:{phone:m(l,v),tablet:m(c,v),device:m(l,v)||m(c,v)},other:{blackberry:m(u,v),blackberry10:m(d,v),opera:m(p,v),firefox:m(f,v),chrome:m(h,v),device:m(u,v)||m(d,v)||m(p,v)||m(f,v)||m(h,v)},any:!1,phone:!1,tablet:!1};return b.any=b.apple.device||b.android.device||b.windows.device||b.other.device,b.phone=b.apple.phone||b.android.phone||b.windows.phone,b.tablet=b.apple.tablet||b.android.tablet||b.windows.tablet,b}}(),w={recalc:{CCTYPE:function(e,t,a){if(a){var s=a.split("|");e.setField("CCTYPE_ALIAS",s[0]);var n=parseInt(s[1],10);if(isNaN(n))e.setField("CCDA","");else{var r=e.getField("DOCDA");r=r?new Date(r+" 00:00:00"):new Date;var i=new Date(r.valueOf()+864e5*n);0===i.getUTCDay()?i=new Date(i.valueOf()-1728e5):6===i.getUTCDay()&&(i=new Date(i.valueOf()-864e5)),e.setField("CCDA",i)}}else e.setField("CCTYPE_ALIAS",""),e.setField("CCDA","")}}},k=function(e,t){if(t)return e;var a,s=/<<[\s\S]+?>>/g,n=e.match(s);if(!n)return e;var r=e.split(s);return a=[r[0]||null],n.forEach((function(e,t){var s,n;switch(e[2]){case"R":n={color:"red"};break;case"G":n={color:"green"};break;case"B":n={color:"blue"};break;case"W":n={color:"white}"};break;case"C":n={};break;default:s=e}s||("+"===e[3]&&(n.fontWeight="bold"),s=u.a.createElement("span",{key:t,style:n},e.slice(4,-2))),a.push(s),r[t+1]&&a.push(r[t+1])})),a},O={},E={isMobile:g,anyMobile:g.any,getField:function(e,t,a){var s=t.toUpperCase().trim(),n=s in e.register&&e.register[s].getValue?e.register[s].getValue(a):s in e.hideNewValues?e.hideNewValues[s]:e.fieldValues[s];return"list"===a?n:(n||"").replace(/\xa4/g,"\n")},setField:function(e,t,a,s){var n=t.toUpperCase(),r="string"===typeof a?a.replace(/\xa4/g,"\n"):a;n in e.register&&e.register[n].setValue?e.register[n].setValue(r,s):e.hideNewValues[n]=r},setFocus:function(e,t){var a;if("number"===typeof t)a=e.focusRows[Math.max(0,Math.min(t,e.focusRows.length-1))];else{if(!t)return;a=t.toUpperCase()}a&&e.register[a]&&e.register[a].setFocus&&!e.register[a].props.readOnly?e.register[a].setFocus():(a=e.focusRows&&e.focusRows[0])&&e.register[a]&&e.register[a].setFocus&&!e.register[a].props.readOnly&&e.register[a].setFocus()},xopen:function(e){e in O&&!O[e].closed?/Firefox/.test(navigator.userAgent)?O[e].alert("\u041e\u043a\u043d\u043e \u0443\u0436\u0435 \u043e\u0442\u043a\u0440\u044b\u0442\u043e"):O[e].focus():O[e]=window.open(e)},serverAction:function(e,t){return new Promise((function(a,s){var n={credentials:"include",method:"post",headers:{"Content-type":"text/plain; charset=UTF-8"},body:t};e.waitSave=!0,e.setState({spinner:!0}),fetch("action",n).then((function(t){e.waitSave=!1,e.setState({spinner:!1}),200===t.status?a(t):t.text().then((function(e){return s(e)}))})).catch((function(t){e.waitSave=!1,e.setState({spinner:!1}),s(t.message)}))}))},upDown:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return 38!==e.keyCode||e.altKey||e.shiftKey||e.ctrlKey?40!==e.keyCode||e.altKey||e.shiftKey||e.ctrlKey?void 0:(t&&(e.stopPropagation(),e.preventDefault()),"down"):(t&&(e.stopPropagation(),e.preventDefault()),"up")},recalc:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,n=e.props.doc,r=e.props.xName;w.recalc[r]&&(setTimeout((function(e){return w.recalc[r](n,t,a,s)}),10),1)||n.sova.recalc&&n.sova.recalc[r]&&setTimeout((function(e){return n.sova.recalc[r](n,t,a,s)}),10)},runCmd:function(e,t,a,s){return e.sova&&e.sova.cmd&&e.sova.cmd[t]?e.sova.cmd[t](e,a,s):e.cmdList&&e.cmdList[t]&&e.cmdList[t](a,s)},_on_:function(e){if(!e||Object.keys(e).length<2)return null;var t={};return Object.keys(e).forEach((function(a){if(a.startsWith("on")){var s=E.partition(e[a],"|"),n=Object(h.a)(s,2),r=n[0],i=n[1];t[a]=function(t){t.preventDefault(),t.stopPropagation(),E.runCmd(e.doc,r,i)}}})),t},hide:function(e,t){return t&&e.sova.hide&&e.sova.hide[t]&&e.sova.hide[t](e)},readOnly:function(e,t){return t&&e.sova.readOnly&&e.sova.readOnly[t]&&e.sova.readOnly[t](e)},label:function(e,t,a){var s=e||"\xa0";return a?t?{div:s,style:Object(n.a)({},a,{width:t}),className:"label"}:{div:s,style:Object(n.a)({},a),className:"label"}:t?{div:s,style:{width:t},className:"label"}:{div:s,className:"label"}},partition:function(e,t){if(e){var a=e.split(t);return a.length>1?[a[0].trim(),a.slice(1).join(t).trim()]:[e.trim(),""]}return["",""]},dtRus:function(e){return(e||"").split("\n").map((function(e){if("string"!==typeof e)return"";if(e.indexOf("-")<0)return e;var t=E.partition(e," "),a=Object(h.a)(t,2),s=a[0],n=a[1];return s.slice(-2)+"."+s.slice(5,7)+"."+s.slice(0,4)+(n?" "+n:"")})).join("\n")},dtDB:function(e){return e.split("\n").map((function(e){if("string"!==typeof e)return"";if(e.indexOf(".")<0)return e;var t=E.partition(e," "),a=Object(h.a)(t,2),s=a[0],n=a[1];return s.slice(-4)+"-"+s.slice(3,5)+"-"+s.slice(0,2)+(n?" "+n:"")})).join("\n")},formatDate:function(e){return("0"+e.getUTCDate()).slice(-2)+"."+("0"+(e.getUTCMonth()+1)).slice(-2)+"."+e.getUTCFullYear()},formatDateTime:function(e){return e.getFullYear()+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+("0"+e.getDate()).slice(-2)+" "+("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2)+":"+("0"+e.getSeconds()).slice(-2)},addJson:function(e,t,a){var s=a||"";return window.SOVA_SEP&&(s=s.replace(/\n/g,"\xa4")),(t||"")===s||e.endsWith("_FD")||e.endsWith(".FD")?"":'"'+e+'":['+JSON.stringify(t||"")+","+JSON.stringify(s)+"],"},jsonByUrl:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"get",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new Promise((function(s,n){var r={credentials:"include"};"get"===t?r.cache=e.startsWith("api.getc?")||e.startsWith("list?")?"force-cache":"no-store":(r.method="post",r.headers={"Content-type":"text/plain; charset=UTF-8"},r.body=a),fetch(e,r).then((function(e){return 200===e.status?e.json():n("jsonByUrl.js.fetch-status: "+e.status)})).then((function(e){return s(e)})).catch((function(e){console.error("jsonByUrl.js.fetch-error:",e.message),n(e.message)}))}))},jsCssFiles:[],addJsCSS:function(e,t){if(!e)return t();var a=[];if(e.forEach((function(e){e&&!E.jsCssFiles.includes(e)&&(a.push(e),E.jsCssFiles.push(e))})),!a.length)return t();var s=0;!function e(n){var r;E.partition(a[s],"::")[0].endsWith(".css")?((r=document.createElement("link")).rel="stylesheet",r.href=a[s]):(r=document.createElement("script")).src=a[s],window.owlDebug&&console.log("include",r.rel||"script",a[s]),document.head.appendChild(r),s++,r.onload=function(n){return s>=a.length?t():e()},r.onerror=function(n){return s>=a.length?t():e()}}()},cmpObj:function(e,t){if("undefined"===typeof e&&"undefined"===typeof t)return!0;if(typeof e!==typeof t)return!1;for(var a in e){if(e.hasOwnProperty(a)!==t.hasOwnProperty(a))return!1;if("object"===typeof e[a]){if(!E.cmpObj(e[a],t[a]))return!1}else if(e[a]!==t[a])return!1}for(var s in t)if("undefined"===typeof e[s])return!1;return!0},splitText:function(e,t){return e?e.includes("\n")&&t.br?e.split("\n").map((function(e,a){return t.s2&&a===t.s2-1?"p"===t.br&&e?u.a.createElement("p",{key:a},u.a.createElement("b",null,k(e))):u.a.createElement("span",{key:a},u.a.createElement("b",null,a?u.a.createElement("br",null):null,k(e))):"p"===t.br&&e?u.a.createElement("p",{key:a},k(e)):u.a.createElement("span",{key:a},a?u.a.createElement("br",null):null,k(e))})):1===t.s2?u.a.createElement("b",null,k(e)):k(e):null}},j=E,x=function(e){function t(e){var a;Object(r.a)(this,t),(a=Object(i.a)(this,Object(o.a)(t).call(this,e))).notLook=function(e){return[".doc",".docx",".xls",".xlsx",".tiff",".zip",".7z"].filter((function(e){return a.href.includes(e)})).length},y()(Object(m.a)(a)),a.state={audio:!1,runUpload:!1},a.progress=null,a.invalid=!1;try{if(!a.props.xName)return Object(i.a)(a);if(a.props.fileObject)a.f_name=a.props.fileObject.name,a.f_type=a.props.fileObject.type,a.f_size=a.props.fileObject.size,a.f_date_db="",a.f_date_crt=j.formatDateTime(new Date(a.props.fileObject.lastModified)),!a.f_type&&a.f_name.endsWith(".7z")&&(a.f_type="application/x-zip-compressed"),a.href="";else{var s,n=a.props.xValue.split("|"),l=Object(h.a)(n,6);a.f_store=l[0],a.f_zip=l[1],a.f_name=l[2],a.f_type=l[3],a.f_size=l[4],s=l[5];var c=j.partition(s,"_"),u=Object(h.a)(c,2);a.f_date_db=u[0],a.f_date_crt=u[1],a.f_date_crt=a.f_date_crt||a.f_date_db,a.makeHref()}}catch(d){console.warn("Filine.js:",d.message),a.invalid=!0}return a}return Object(l.a)(t,e),Object(f.a)(t,[{key:"delFile",value:function(e){this.props.delFile(this.props.xName)}},{key:"editFile",value:function(e){var t="http://127.0.0.1:3080/apiget?execModule&"+this.props.dbAlias+"&"+Date.now();fetch(t,{credentials:"include"}).then((function(e){return e.text().then((function(e){return console.log("=>"+e+"<=")}))})).then((function(e){console.log("=>"+e+"<=")})).catch((function(e){alert("editFile.fetch-error:"+e.message),console.error("editFile.fetch-error:",e)}))}},{key:"openFile",value:function(e){var t=this;if(this.notLook())return j.xopen("docopen?"+this.href);var a=Math.min(this.props.doc.width,1010)-10,s=Math.min(this.props.doc.height,610)-10,n={style:{width:a,height:s,background:"#def"},buttons:this.href.includes(".pdf?")?["\u041e\u0442\u043a\u0440\u044b\u0442\u044c+|O","\u0417\u0430\u043a\u0440\u044b\u0442\u044c"]:["\u041e\u0442\u043a\u0440\u044b\u0442\u044c+|O","\u041f\u0435\u0447\u0430\u0442\u044c|P","\u041a\u043e\u0434\u0438\u0440\u043e\u0432\u043a\u0430|C","\u0417\u0430\u043a\u0440\u044b\u0442\u044c"],cmCancel:function(){return t.props.doc.setFocus(t.props.doc.focus)},cmButton:function(e,a){switch(e){case"O":j.xopen("docopen?"+t.href+"&UTF-8");break;case"C":j.xopen("docopen?"+t.href+"&windows-1251");break;default:a.contentWindow.print()}}},r={width:a-130,maxHeight:s-30,overflow:"hidden"};this.props.doc.dlg.show("\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u0432\u043b\u043e\u0436\u0435\u043d\u0438\u044f",this.href+"&UTF-8",n,r)}},{key:"componentWillReceiveProps",value:function(e){!e.runUpload&&this.progress&&(delete this.progress,this.progress=null),this.setState({audio:this.state.audio,runUpload:!!e.fileObject&&e.runUpload})}},{key:"componentWillUpdate",value:function(e,t){if(!this.state.runUpload&&t.runUpload){var a=new FormData;a.append("attachment",this.props.fileObject);var s=["upload?"+this.props.dbAlias,this.f_size,this.f_date_crt,this.props.docRef||this.props.unid].join("&");this.props.fileObject.filineErr=null,this.runXHR(s,a)}}},{key:"render",value:function(){var e=this;if(this.state.invalid)return u.a.createElement("div",{className:"filine-blank"},"invalid field: "+this.props.xName);var t,a,s=["9.5cm","1.7cm","4.5cm","0.85cm"],n=null;if(this.props.fileObject)t=this.f_name,a=this.state.runUpload?u.a.createElement("div",{style:{width:s[2]}},u.a.createElement("progress",{value:"0",max:"1",style:{width:s[2]},ref:function(t){return e.progress=t}})):u.a.createElement("div",{style:{width:s[2]},title:"\u0424\u0430\u0439\u043b \u043d\u0435 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d \u0432 \u0431\u0430\u0437\u0435"},j.dtRus(this.f_date_crt));else{if(t=this.state.audio?u.a.createElement("audio",{controls:"controls",autoPlay:"autoplay",src:this.href}):u.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:this.href,title:"\u041e\u0442\u043a\u0440\u044b\u0442\u044c \u0444\u0430\u0439\u043b \u043f\u043e \u0441\u0441\u044b\u043b\u043a\u0435. \u0414\u043b\u044f \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u0444\u0430\u0439\u043b\u0430 \u043d\u0430 \u0434\u0438\u0441\u043a \u043d\u0430\u0436\u043c\u0438\u0442\u0435 \u043f\u0440\u0430\u0432\u0443\u044e \u043a\u043d\u043e\u043f\u043a\u0443 \u043c\u044b\u0448\u0438 \u0438 \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 '\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u043a\u0430\u043a...'"},this.f_name),this.f_type.indexOf("audio")<0){var r=this.notLook()?["\u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u043d\u0430 \u0434\u0438\u0441\u043a","\u0441\u043a\u0430\u0447\u0430\u0442\u044c"]:["\u041e\u0442\u043a\u0440\u044b\u0442\u044c \u0434\u043b\u044f \u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440\u0430 \u0438\u043b\u0438 \u043f\u0435\u0447\u0430\u0442\u0438","\u0431\u044b\u0441\u0442\u0440\u044b\u0439 \u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440"];n=u.a.createElement("span",{style:{color:"blue",cursor:"pointer"},onClick:this.openFile,title:r[0]},r[1],u.a.createElement("br",null))}else n=u.a.createElement("span",{style:{color:"green",cursor:"pointer"},onClick:function(){return e.setState({audio:!e.state.audio})},title:this.state.audio?"\u0421\u0442\u043e\u043f":"\u041f\u0443\u0441\u043a"},this.state.audio?"\u043e\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0437\u0430\u043f\u0438\u0441\u044c":"\u043f\u0440\u043e\u0441\u043b\u0443\u0448\u0430\u0442\u044c \u0437\u0430\u043f\u0438\u0441\u044c",u.a.createElement("br",null));a=u.a.createElement("div",{style:{width:s[2]},title:"\u0417\u0430\u043f\u0438\u0441\u044c \u0432 \u0431\u0430\u0437\u0443 "+j.dtRus(this.f_date_db)},n,j.dtRus(this.f_date_crt))}return u.a.createElement("div",{className:"filine"},u.a.createElement("div",{style:{width:s[0]}},t),u.a.createElement("div",{style:{width:s[1]}}," ",this.f_size," "),a,u.a.createElement("span",{onClick:this.delFile,style:{width:s[3],display:this.props.readOnly||this.state.runUpload?"none":"table-cell"},title:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0432\u043b\u043e\u0436\u0435\u043d\u0438\u0435"},"\xd7"))}},{key:"runXHR",value:function(e,t){var a=this,s=new XMLHttpRequest;s.open("post",e,!0),s.withCredentials=!0,s.addEventListener("load",(function(){200===s.status?a.uploadSuccess(s.responseText):a.uploadError(s.status+" "+s.responseText)})),s.addEventListener("error",(function(e){return a.uploadError(e.message||e)})),s.upload.addEventListener("progress",(function(e){a.progress&&(a.progress.value=e.loaded,a.progress.max=e.total)})),s.send(t)}},{key:"uploadSuccess",value:function(e){try{var t=e.split("&"),a=this.props.filter+t[0];this.f_store=t[1],this.f_date_db=t[2],this.f_zip=t[3]+(1===t[3].length&&this.props.docRef?"R":""),this.makeHref(t[0]),this.setState({runUpload:!1});var s=[this.f_store,this.f_zip,this.f_name,this.f_type,this.f_size,this.f_date_db].join("|");this.props.uploadDone(this.props.xName,a,s)}catch(n){console.log("Filine.js: invalid responseText of xhr",n.message),this.uploadError("uploadSuccess - exception after upload")}}},{key:"makeHref",value:function(e){this.href=["download/"+this.f_name+"?"+this.props.dbAlias,this.props.unid,e||this.props.xName.split("_")[1],this.f_store,this.f_zip,this.f_type,this.f_size].join("&")}},{key:"uploadError",value:function(e){this.props.fileObject.filineErr=e||"error",this.setState({runUpload:!1}),this.props.uploadDone(this.props.xName,"","",e),console.log("uploadError:",e)}}]),t}(u.a.Component),D=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(i.a)(this,Object(o.a)(t).call(this,e))).initialize=function(e){a.init(),a.forceUpdate()},y()(Object(m.a)(a)),a.labelBlank="\u043f\u043e\u043b\u0435 \u0434\u043b\u044f \u043f\u0440\u0438\u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u043d\u044b\u0445 \u0444\u0430\u0439\u043b\u043e\u0432",a.nDescr=0,a.fileArr=[],a.filter=a.props.fileShow,a.init(),a.state={runUpload:!1},a}return Object(l.a)(t,e),Object(f.a)(t,[{key:"init",value:function(){var e=this;this.fileArr.forEach((function(t,a){return delete e.fileArr[a]})),this.fileArr=[];var t=[];Object.keys(this.props.doc.fieldValues).forEach((function(a){if(a.startsWith(e.filter)){var s=e.props.doc.fieldValues[a].split("|");6===s.length?t.push(s[5].split("_")[0]+a+"|"+a):console.warn("FileShow.js: \u043d\u0435\u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u0430\u044f \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0430 \u043f\u043e\u043b\u044f:",a,e.props.doc.fieldValues[a])}})),t.sort().forEach((function(t){var a=t.split("|")[1];e.fileArr.push({key:e.filter+e.nDescr++,xName:a,oldValue:e.props.doc.fieldValues[a],newValue:e.props.doc.fieldValues[a]})}))}},{key:"addFiles",value:function(e){var t=e.dataTransfer?e.dataTransfer.files:e.target.files;if(t&&!this.props.readOnly){if(!t[0].size)return this.props.doc.msg.box("\u041d\u0435\u043b\u044c\u0437\u044f \u043f\u0440\u0438\u0441\u043e\u0435\u0434\u0438\u043d\u0438\u0442\u044c \u0444\u0430\u0439\u043b \u043d\u0443\u043b\u0435\u0432\u043e\u0439 \u0434\u043b\u0438\u043d\u044b");var a=!0,s=!1,n=void 0;try{for(var r,i=t[Symbol.iterator]();!(a=(r=i.next()).done);a=!0){var o=r.value,l=this.filter+this.nDescr++;this.fileArr.push({key:l,xName:l,fileObject:o})}}catch(c){s=!0,n=c}finally{try{a||null==i.return||i.return()}finally{if(s)throw n}}this.forceUpdate()}}},{key:"delFile",value:function(e){this.props.readOnly||(this.fileArr.forEach((function(t){e===t.xName&&(t.del=!0)})),this.forceUpdate())}},{key:"getNewValues",value:function(e){var t="";return this.fileArr.forEach((function(a){a.del?a.oldValue&&(t+=E.addJson(a.xName,a.oldValue,"")):!a.oldValue&&a.newValue?t+=E.addJson(a.xName,"",a.newValue):a.fileObject&&!e&&(t+=E.addJson(a.xName,"",'\u0424\u0430\u0439\u043b "'+a.fileObject.name+'" \u043d\u0435 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d'))})),t}},{key:"hasAtt",value:function(){var e=[];if(this.fileArr.forEach((function(t){t.del||(t.fileObject?e.push(t.fileObject.name):e.push(t.oldValue.split("|")[2]))})),e.length)return e.join(", ")}},{key:"startUpload",value:function(){if(this.run=!1,this.uploadError=!1,!this.props.readOnly)if(this.state.runUpload)this.run=!0;else for(var e=0;e<this.fileArr.length;e++)if(this.fileArr[e].fileObject&&!this.fileArr[e].del)return this.setState({runUpload:!0}),void(this.run=!0)}},{key:"uploadDone",value:function(e,t,a,s){var n=this;s?(this.uploadError=!0,this.props.doc.msg.error("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0435 \u0444\u0430\u0439\u043b\u0430 \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440:\n\n"+s)):this.fileArr.forEach((function(s){e===s.xName&&(s.xName=t,s.newValue=a,delete s.fileObject,s.fileObject=null)}));var r=!1;this.fileArr.forEach((function(e){e.fileObject&&!e.fileObject.filineErr&&(r=!0,n.forceUpdate())})),r||(this.setState({runUpload:!1}),this.run=!1,this.props.uploadDone(this.filter))}},{key:"render",value:function(){var e=this,t=this.fileArr.map((function(t){return t.del?null:u.a.createElement(x,{key:t.key,xName:t.xName,xValue:t.newValue,fileObject:t.fileObject,dbAlias:e.props.doc.dbAlias,unid:e.props.doc.unid,docRef:e.props.doc.getField("ref")||null,delFile:e.delFile,runUpload:e.state.runUpload,uploadDone:e.uploadDone,filter:e.filter,readOnly:e.props.readOnly,doc:e.props.doc})})).filter((function(e){return e})),a=this.props.ttaFileShow||"tta"+(this.props.readOnly?" read-only":"");return u.a.createElement("div",{className:this.props.className,style:Object(n.a)({},this.props.style)},u.a.createElement("div",{className:"row"},u.a.createElement("div",{className:this.props.readOnly?"label":"fileLabel",style:{minWidth:this.props.wl||0,width:this.props.wl||"auto",padding:"2px 3px 8px 0"}},u.a.createElement("input",{type:"file",multiple:!0,onChange:this.addFiles,style:{display:"none"},ref:function(t){e.props.readOnly||(e.btnFile=t)}}),u.a.createElement("span",{onClick:function(){return e.btnFile&&!e.props.readOnly&&e.btnFile.click()},style:{cursor:this.props.readOnly?"default":"pointer"}},this.props.label)),u.a.createElement("div",{className:a},t.length?t:u.a.createElement("div",{className:"filine-blank"},this.labelBlank))))}}]),t}(u.a.Component),C=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(i.a)(this,Object(o.a)(t).call(this,e))).setValue=function(e,t){return a.setState({src:e,srcDoc:t})},a.render=function(e){var t=a.state.src,s=null;return a.state.srcDoc?(t=null,s=a.state.srcDoc):[".jpg",".jpeg",".png",".gif"].filter((function(e){return t.toLowerCase().includes(e)})).length&&(s='<html><body style="margin:0; text-align: center"><img src="'.concat(t,'" width="100%" alt="alt"></body></html>'),t=null),u.a.createElement("div",{style:{position:"relative"}},a.state.isLoading&&a.state.spinner?u.a.createElement("div",{className:"spinner"}):null,u.a.createElement("iframe",{name:a.props.name,id:a.props.id,ref:a.props.name||"iframe",src:t,srcDoc:s,style:Object(n.a)({},a.props.style),title:a.props.title||"Title",onLoad:function(e){a.props.load&&a.props.load(Object(m.a)(a)),a.setState({isLoading:!1})}}))},y()(Object(m.a)(a)),a.state={isLoading:!0,src:a.props.src,srcDoc:a.props.srcDoc||!a.props.src&&"<html><body></body></html>"},setTimeout((function(e){return a.state.isLoading?a.setState(Object(n.a)({},a.state,{spinner:!0})):""}),1e3),a}return Object(l.a)(t,e),t}(u.a.Component),S=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(i.a)(this,Object(o.a)(t).call(this,e))).setValue=function(e){return a.setState({label:e.label||a.state.label,cmd:e.cmd||a.state.cmd,title:e.title||a.state.title,param:e.param||a.state.param,className:e.className||a.state.className})},a.setFocus=function(e){a.setState({focusOn:!0}),a.div&&a.div.focus()},a.onclick=function(e){return a.props.btnClick?a.props.btnClick(a.props.doc,a.state.cmd,a.state.param,e.ctrlKey):j.runCmd(a.props.doc,a.state.cmd,a.state.param,e.ctrlKey)},y()(Object(m.a)(a)),a.state={focusOn:!1,label:a.props.label,cmd:a.props.cmd,title:a.props.title,param:a.props.param,className:a.props.className},a}return Object(l.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){var e,t=this;return this.state.label.includes("\n")?(e=[],this.state.label.split("\n").forEach((function(a,s){s?e.push(u.a.createElement("span",{key:s},u.a.createElement("br",null),a)):e.push(t.props.s2?u.a.createElement("span",{key:s},u.a.createElement("b",null,a)):u.a.createElement("span",{key:s},a))}))):e=this.props.s2?u.a.createElement("b",null,this.state.label,"l"):this.state.label,u.a.createElement("div",{style:Object(n.a)({cursor:"pointer"},this.props.style),tabIndex:"1",className:(this.state.className||"rsvTop")+(this.state.focusOn?" on-focus":""),onClick:this.onclick,ref:function(e){return t.div=e},title:this.state.title},e)}}]),t}(u.a.Component),N=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(i.a)(this,Object(o.a)(t).call(this,e))).setValue=function(e){return a.setState({rtfText:e})},y()(Object(m.a)(a)),a.state={rtfText:a.props.xValue},a}return Object(l.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){var e=F(this.state.rtfText,this.props.doc,this.props.readOnly,null);return e?u.a.createElement("div",{className:this.props.className,style:Object(n.a)({},this.props.style)},e):null}}]),t}(u.a.Component),F=function(e,t,a,s){var n,r=/{_[\s\S]+?_}/g,i=e.match(r);if(!i)return e;var o=e.split(r);return n=o[0]?o[0].includes("\n")?[o[0].split("\n").map((function(e,t){return u.a.createElement("span",{key:"_i"+t},t?u.a.createElement("br",null):null,e)}))]:[o[0]]:[null],i.forEach((function(e,r){var i;try{var l=JSON.parse(e.slice(2,-2));i=ne(r,l,t,a,s)}catch(c){i="\u041e\u0448\u0438\u0431\u043a\u0430 rtf:"+c.name+":"+c.message+"<->"+e.slice(1,-1)}n.push(i),o[r+1]&&(o[r+1].includes("\n")?n.push(o[r+1].split("\n").map((function(e,t){return u.a.createElement("span",{key:r+"i"+t},t?u.a.createElement("br",null):null,e)}))):n.push(o[r+1]))})),n},_=N,L=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(i.a)(this,Object(o.a)(t).call(this,e))).setValue=function(e){var t="dt"===a.props.type?j.dtRus(e):e;a.updateComp(t||"")},a.getValue=function(e){var t=a.state.text;return"dt"===a.props.type?e?j.dtRus(t):j.dtDB(t):"list"===e?[t,a.selectionStart,a.selectionEnd]:t},a.setFocus=function(e){a.setState({focusOn:!0}),a.input.focus()},a.onselect=function(e){a.selectionStart=a.input.selectionStart,a.selectionEnd=a.input.selectionEnd},a.render=function(e){var t=a.lb?u.a.createElement("div",{className:"btn-lb-zone",onClick:function(e){return a.showListBox(e)}},u.a.createElement("div",{className:"btn-lb",style:{marginLeft:3}})):null;return u.a.createElement("div",Object.assign({style:Object(n.a)({},a.props.style)},j._on_(a.props)),u.a.createElement("div",{className:(a.props.ttaClassName||"tta")+(a.state.focusOn?" on-focus":"")+(a.props.readOnly?" read-only":""),style:Object(n.a)({},a.props.ttaStyle)},u.a.createElement("div",{style:Object(n.a)({},a.props.ttaStyle,{height:a.state.height,display:"table-cell"})},u.a.createElement("textarea",{tabIndex:a.props.readOnly?-1:"0",placeholder:a.props.readOnly?"":a.props.placeholder||a.placeholder,value:a.state.text,onKeyDown:a.onkeydown,onKeyPress:a.onkeypress,onChange:function(e){return a.updateComp(e.target.value)},onFocus:function(e){return a.setState({focusOn:!0})},onSelect:function(e){return a.onselect(e)},onBlur:function(e){return a.setState({focusOn:!1})},style:{height:a.state.height+0,margin:0},ref:function(e){return a.input=e},readOnly:a.props.readOnly}),u.a.createElement("textarea",{value:a.state.text,onChange:function(){return null},style:{display:"block",visibility:"hidden",height:1,overflow:"hidden"},ref:function(e){return a.shadow=e}})),t))},y()(Object(m.a)(a)),a.shadow=null,a.input=null,a.savedH=16,a.sep=a.props.sep||"|",!["lbse","lbme"].includes(a.props.type)||a.props.readOnly?(a.lb=!1,a.placeholder="\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0442\u0435\u043a\u0441\u0442"):(a.lb=!0,a.multi="lbmd"===a.props.type,a.placeholder="\u0412\u044b\u0431\u043e\u0440 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0438\u0437 \u0441\u043f\u0438\u0441\u043a\u0430: <Alt-\u0441\u0442\u0440\u0435\u043b\u043a\u0430 \u0432\u043d\u0438\u0437>"),a.state={focusOn:!1,height:0,text:a.props.xValue||""},a}return Object(l.a)(t,e),Object(f.a)(t,[{key:"changeDropList",value:function(e){var t=this;if(this.props.readOnly)return this.setState({dropList:[]});if(this.lb){var a=this.props.ls;if("string"===typeof a){if(a.includes("|||")){var s=a.split("|||"),n=Object(h.a)(s,2),r=n[0];a=n[1].replace(/{FIELD}/g,this.props.doc.getField(r))}else a=e||a;j.jsonByUrl(a).then((function(e){return t.setState({dropList:e||[]})})).catch((function(e){return console.error("Text.js: Util.jsonByUrl:"+e)}))}else this.setState({dropList:e||[]})}}},{key:"componentDidMount",value:function(){this.changeDropList(this.props.ls),this.updateComp(this.state.text)}},{key:"onkeydown",value:function(e){if(!this.props.readOnly){var t=j.upDown(e,!1);if("up"===t){if(0===this.input.selectionStart)return this.props.doc.setFocus(this.props.myRow-1)}else if("down"===t&&this.input.selectionStart>=this.state.text.length)return this.props.doc.setFocus(this.props.myRow+1);"tx"!==this.props.type?(40===e.keyCode&&e.altKey||13===e.keyCode&&(!e.shiftKey&&!this.props.shiftEnter||e.shiftKey&&this.props.shiftEnter))&&this.showListBox(e):13===e.keyCode&&this.props.keyCode_13&&(e.stopPropagation(),e.preventDefault(),j.runCmd(this.props.doc,this.props.keyCode_13,this.state.text,e.ctrlKey))}}},{key:"onkeypress",value:function(e){if(!e.ctrlKey&&this.lb&&!this.state.text){var t=e.key.toLowerCase(),a=!0,s=!1,n=void 0;try{for(var r,i=this.state.dropList[Symbol.iterator]();!(a=(r=i.next()).done);a=!0){var o=r.value;if(o.toLowerCase().startsWith(t)){e.stopPropagation(),e.preventDefault(),this.updateValue(o);break}}}catch(l){s=!0,n=l}finally{try{a||null==i.return||i.return()}finally{if(s)throw n}}}}},{key:"showListBox",value:function(e){var t=this;e.stopPropagation(),e.preventDefault();var a=this.state.text,s=this.state.dropList.map((function(e){return e.split(t.sep)[0]})),n=[],r=[];a.split("\n").forEach((function(e){var a=s.indexOf(e.split(t.sep)[0]);a>=0?n.push(a):r.push(e)})),this.updateComp(r.join("\n")),this.props.doc.msg.list(this.state.dropList,"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435",{multi:"lbme"===this.props.type,checked:n,sep:this.sep},this.props.small).then((function(e){e&&t.updateValue(e),t.input.focus()})).catch((function(e){t.updateComp(a),t.input.focus()}))}},{key:"updateValue",value:function(e){var t=this,a=this.state.text.split("\n"),s="";e.replace(/\xa4/g,"\n").split("\n").forEach((function(e){var n=e.includes(t.sep)?t.props.alias?e.split(t.sep)[1]:e.split(t.sep)[0]:e;a.includes(n)||(s+=n+"\n")})),s&&(s=(this.state.text&&"lbme"===this.props.type?this.state.text+"\n":"")+s.slice(0,-1),this.updateComp(s)),j.recalc(this,s||this.state.text)}},{key:"updateComp",value:function(e){this.shadow&&(this.shadow.value=e,this.shadow.scrollHeight&&(this.savedH=this.shadow.scrollHeight),this.setState({text:e,height:this.savedH+2}))}}]),t}(u.a.Component),V=function(e){function t(e){var a;Object(r.a)(this,t),(a=Object(i.a)(this,Object(o.a)(t).call(this,e))).onclick=function(e){return a.props.toggle(a.props.index,e)},a.ondubleclick=function(e){e.stopPropagation(),e.preventDefault()};var s=!a.props.sel&&a.props.iShow%2&&!a.props.evenColor?{background:"#f4f8ff"}:{};return a.props.multi&&a.props.check&&(s.fontWeight="bold",a.props.sel||(s.color="#00f")),a.state={style:Object(n.a)({},s)},a}return Object(l.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){var e=this,t=this.props.multi?u.a.createElement("span",{className:"multi",onClick:this.onclick,onDoubleClick:this.ondubleclick},this.props.check?"\u2228":"\xa0"):null,a=this.props.listItemClassName||"listItem";this.props.sel&&(a+=" "+(this.props.listItemSelClassName||"listItemSel"));var s=Object(n.a)({},this.state.style);return this.props.sel&&delete s.background,u.a.createElement("div",{className:a,ref:function(t){return e.div=t},tabIndex:"0",onClick:function(t){return e.props.onclick(e.props.iShow)},onDoubleClick:function(t){return e.props.ondoubleclick(!0)},onMouseOver:function(t){return!e.props.sel&&e.props.evenColor&&e.setState({style:{background:"#f0f4ff"}})},onMouseOut:function(t){return!e.props.sel&&e.props.evenColor&&e.setState({style:{background:"#fff"}})},style:s},t,this.props.items[this.props.index].label)}}]),t}(u.a.Component),B=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(i.a)(this,Object(o.a)(t).call(this,e))).componentDidMount=function(e){return a.changeDropList()},a.getValue=function(e){return"undefined"===typeof a.items[a.state.sel]?a.props.xValue||"undefined":a.items[a.state.sel].label},a.setValue=function(e){return a.setState({sel:e})},a.onclick=function(e){a.setState({sel:e}),a.props.saveAlias&&a.props.doc.setField(a.props.xName+"_ALIAS",a.items[e].opt),j.recalc(Object(m.a)(a),a.items[e].label,a.items[e].opt,e)},y()(Object(m.a)(a)),a.items=[],a.dom=u.a.createRef(),a.state={sel:0,focusOn:!1},a}return Object(l.a)(t,e),Object(f.a)(t,[{key:"changeDropList",value:function(e){var t=this,a=this.props.ls;if("string"===typeof a){if(a.includes("|||")){var s=a.split("|||"),n=Object(h.a)(s,2),r=n[0];a=n[1].replace(/{FIELD}/g,e||this.props.doc.getField(r))}else a=e||a;j.jsonByUrl(a).then((function(e){t.items=(e||[]).map((function(e){var t=j.partition(e,"|"),a=Object(h.a)(t,2);return{ref:null,label:a[0],opt:a[1]}})),t.setState({sel:0})})).catch((function(e){var a="List.js: Util.jsonByUrl:"+e;t.items=[{ref:null,label:a,opt:""}],console.error(a),t.setState({sel:0})}))}else this.items=(e||a).map((function(e){var t=j.partition(e,"|"),a=Object(h.a)(t,2);return{ref:null,label:a[0],opt:a[1]}})),this.setState({sel:0})}},{key:"render",value:function(){var e=this,t=this.items.map((function(t,a){return u.a.createElement(V,{key:Math.random(),listItemClassName:e.props.listItemClassName,listItemSelClassName:e.props.listItemSelClassName,index:a,iShow:a,items:e.items,evenColor:e.props.evenColor,onclick:function(t){return e.onclick(a)},ondoubleclick:function(e){},sel:e.state.sel===a,ref:function(t){t&&e.items[a]&&(e.items[a].ref=t)}})}));return u.a.createElement("div",{className:this.props.className,style:Object(n.a)({},this.props.style),ref:this.dom},u.a.createElement("div",{ref:function(t){return e.tta=t}},t.length?t:""))}}]),t}(u.a.Component),T=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(i.a)(this,Object(o.a)(t).call(this,e))).setValue=function(e){return a.setV(e)},a.getValue=function(e){return a.state.value},a.setFocus=function(e){a.setState({focusOn:!0}),a.tta.focus()},a.componentDidMount=function(e){return a.changeDropList()},y()(Object(m.a)(a)),a.multi="lbmd"===a.props.type,a.placeholder="\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0438\u0437 \u0441\u043f\u0438\u0441\u043a\u0430",a.inputEnable=!0,a.input="",a.sep=a.props.sep||"|",a.state={value:a.props.xValue||"",focusOn:!1},a}return Object(l.a)(t,e),Object(f.a)(t,[{key:"setV",value:function(e){this.inputEnable=!0,this.input="",this.setState({value:e||""})}},{key:"changeDropList",value:function(e){var t=this,a=this.props.ls;if(this.props.readOnly||!a||!a.length)return this.setState({dropList:[]});if("string"===typeof a){if(a.includes("|||")){var s=a.split("|||"),n=Object(h.a)(s,2),r=n[0];a=n[1].replace(/{FIELD}/g,e||this.props.doc.getField(r))}j.jsonByUrl(a).then((function(e){t.labels=(e||[]).map((function(e){return e.split(t.sep)[0].toLowerCase()})),t.values=t.props.alias&&(e||[]).map((function(e){return j.partition(e,t.sep)[1]})),t.setState({value:t.state.value||"",dropList:e||[]})})).catch((function(e){return console.error("ListBoxSD.js: Util.jsonByUrl:"+e)}))}else{var i=e||a;this.labels=i.map((function(e){return e.split(t.sep)[0].toLowerCase()})),this.values=this.props.alias&&i.map((function(e){return j.partition(e,t.sep)[1]})),this.setState({value:this.state.value||"",dropList:i})}}},{key:"onkeydown",value:function(e){var t=j.upDown(e);if("up"===t)return this.props.doc.setFocus(this.props.myRow-1);if("down"===t)return this.props.doc.setFocus(this.props.myRow+1);var a=0;switch(e.keyCode){case 37:case 39:this.input="",this.inputEnable=!this.state.value,this.forceUpdate();break;case 13:return this.showListBox(e);case 40:return!e.altKey||this.showListBox(e);case 8:return this.delValue(e,-1);case 46:return this.delValue(e,0);case 32:var s=[];if(this.state.value){var n=this.state.value.split("\n");s=n.slice(0,-1),(a=this.labels.indexOf(n.slice(-1)[0].split(this.sep)[0].toLowerCase()))>=0&&a<this.labels.length-1?a+=1:(this.props.alias&&(a=this.values.indexOf(n.slice(-1)[0].split(this.sep)[0])),a>=0&&a<this.labels.length-1?a+=1:a=0)}s.push(this.state.dropList[a]),this.updateValue(s.join("\n"));break;default:return}e.stopPropagation(),e.preventDefault()}},{key:"onkeypress",value:function(e){if(!e.ctrlKey){var t=e.key.toLowerCase();if(!this.inputEnable)return this.showListBox(e,t);for(var a in e.stopPropagation(),this.labels)if(this.labels[a].startsWith(this.input+t))return this.input+=t,void this.updateValue(this.state.dropList[a],!1);var s=!0,n=!1,r=void 0;try{for(var i,o="(\xab\"'-"[Symbol.iterator]();!(s=(i=o.next()).done);s=!0){var l=i.value+this.input+t;for(var c in this.labels)if(this.labels[c].includes(l))return this.input+=t,void this.updateValue(this.state.dropList[c],!1)}}catch(u){n=!0,r=u}finally{try{s||null==o.return||o.return()}finally{if(n)throw r}}}}},{key:"onpaste",value:function(e){try{var t=e.clipboardData.getData("text/plain").toLowerCase();if(this.inputEnable){this.input="";var a,s=0;for(var n in t){for(var r=!1;s<this.labels.length;s++)if(this.labels[s].startsWith(this.input+t[n])){r=!0;break}if(!r)break;a=s,this.input+=t[n]}this.input&&this.updateValue(this.state.dropList[a],!1)}else this.showListBox(e,t)}catch(i){console.error("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0432\u0441\u0442\u0430\u0432\u043a\u0435 \u0442\u0435\u043a\u0441\u0430:"+i.message)}e.stopPropagation(),e.preventDefault()}},{key:"showListBox",value:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e.stopPropagation(),e.preventDefault(),this.state.dropList&&this.state.dropList.length){var s=this.state.dropList.map((function(e){return e.split(t.sep)[0]})),n=this.input||a||!this.state.value?0:this.state.value.split("\n").reduce((function(e,a){var n=a.split(t.sep)[0],r=s.indexOf(n);return r>=0?e.push(r):t.props.alias&&(r=t.values.indexOf(n))>=0&&e.push(r),e}),[]);this.props.doc.msg.list(this.state.dropList,"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435",{multi:this.multi&&!a,checked:n,text:this.input||a,sep:this.sep},this.props.small).then((function(e){t.updateValue(e,!0,!!a&&t.multi),t.tta.focus()})).catch((function(e){return t.tta.focus()}))}}},{key:"findAlias",value:function(e){var t=this,a=[],s=[];return e.split("\n").forEach((function(e){var n=j.partition(e,t.sep),r=Object(h.a)(n,2),i=r[0],o=r[1];t.props.alias?a.push(o||i):(a.push(i),s.push(o))})),[a.join("\n"),s.join("\n")]}},{key:"updateValue",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t&&(this.input=""),this.inputEnable=!(e&&t);var s=this.findAlias(e),n=Object(h.a)(s,2),r=n[0],i=n[1];if(this.setState({value:(a&&this.state.value?this.state.value+"\n":"")+r}),this.props.saveAlias){if(a){var o=this.props.doc.getField(this.props.xName+"_ALIAS");i=(o?o+"\n":"")+i}this.props.doc.setField(this.props.xName+"_ALIAS",i)}j.recalc(this,r,i)}},{key:"delValue",value:function(e,t){e.stopPropagation(),e.preventDefault();var a=this.state.value.split("\n");if(a.length){t<0&&(t=a.length-1);var s="";if(this.props.saveAlias){var n=this.props.doc.getField(this.props.xName+"_ALIAS").split("\n");a.length===n.length&&(s=n.filter((function(e,a){return a!==t})).join("\n"),this.props.doc.setField(this.props.xName+"_ALIAS",s))}var r=a.filter((function(e,a){return a!==t})).join("\n");this.input="",this.inputEnable=!r,this.setState({value:r}),j.recalc(this,r,s)}}},{key:"render",value:function(){var e=this;if(this.props.readOnly)return u.a.createElement(L,{xValue:this.props.xValue||"",readOnly:!0,style:Object(n.a)({},this.props.style)});var t=this.state.focusOn&&!this.input?u.a.createElement("span",{className:"lbCursor"},"|"):null,a=this.state.value.split("\n").map((function(a,s,n){if(!a){var r=e.props.readOnly||e.state.focusOn?"\xa0":e.props.placeholder||e.placeholder;return u.a.createElement("div",{key:s,style:{border:"1px solid transparent"}},u.a.createElement("span",{className:"placeholder"},r),t)}var i=a.split(e.sep)[0],o=null;return e.input&&0===i.toLowerCase().indexOf(e.input)&&(o=u.a.createElement("b",{style:{color:"#f08"}},i.slice(0,e.input.length)),i=i.slice(e.input.length)),u.a.createElement("div",{key:s,style:{border:"1px solid #eee"}},u.a.createElement("span",{className:"delBtn",title:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c",onClick:function(t){return e.delValue(t,s)}},"\xd7"),o,i,s<n.length-1?null:t)}));return u.a.createElement("div",{style:Object(n.a)({},this.props.style)},u.a.createElement("div",{className:"tta"+(this.state.focusOn?" on-focus":""),style:Object(n.a)({padding:"2px 0 2px 2px"},this.props.ttaStyle),tabIndex:"0",onFocus:function(t){e.inputEnable=!e.state.value,e.setState({focusOn:!0})},onBlur:function(t){e.inputEnable=!1,e.input="",e.setState({focusOn:!1})},onKeyDown:this.onkeydown,onKeyPress:this.onkeypress,onPaste:this.onpaste,ref:function(t){return e.tta=t}},u.a.createElement("div",{style:{display:"table-cell"}},a),u.a.createElement("div",{className:"btn-lb-zone",onClick:function(t){return e.showListBox(t)}},u.a.createElement("div",{className:"btn-lbsd"}))))}}]),t}(u.a.Component),U=function(e){function t(e){var a;Object(r.a)(this,t),a=Object(i.a)(this,Object(o.a)(t).call(this,e)),y()(Object(m.a)(a));var s=parseInt(a.props.dayX,10)||29;return a.dayX=new Date(+new Date+864e5*s),a}return Object(l.a)(t,e),Object(f.a)(t,[{key:"getStrDate",value:function(e){return e.getFullYear()+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+("0"+e.getDate()).slice(-2)}},{key:"changeCurDate",value:function(e,t,a){this.props.cur.setFullYear(this.props.cur.getFullYear()+e,this.props.cur.getMonth()+t,this.props.cur.getDate()+a),this.forceUpdate()}},{key:"compareDates",value:function(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()}},{key:"keyHandler",value:function(e){if(!e.altKey&&!e.ctrlKey){if(13===e.keyCode)return this.props.setDate(this.getStrDate(this.props.cur),e);if(27===e.keyCode)return this.props.setDate(0,e);switch(e.keyCode){case 37:this.changeCurDate(0,0,-1);break;case 38:this.changeCurDate(0,0,-7);break;case 39:this.changeCurDate(0,0,1);break;case 40:this.changeCurDate(0,0,7);break;case 33:this.changeCurDate(0,-1,0);break;case 34:this.changeCurDate(0,1,0);break;case 36:this.props.cur.setFullYear(this.props.cur.getFullYear(),this.props.cur.getMonth(),1),this.forceUpdate();break;case 35:this.props.cur.setFullYear(this.props.cur.getFullYear(),this.props.cur.getMonth()+1,1),this.changeCurDate(0,0,-1);break;case 32:this.props.cur.setTime(+new Date),this.forceUpdate()}e.stopPropagation(),e.preventDefault()}}},{key:"render",value:function(){for(var e=this,t=new Date,a="\u042f\u043d\u0432\u0430\u0440\u044c \u0424\u0435\u0432\u0440\u0430\u043b\u044c \u041c\u0430\u0440\u0442 \u0410\u043f\u0440\u0435\u043b\u044c \u041c\u0430\u0439 \u0418\u044e\u043d\u044c \u0418\u044e\u043b\u044c \u0410\u0432\u0433\u0443\u0441\u0442 \u0421\u0435\u043d\u0442\u044f\u0431\u0440\u044c \u041e\u043a\u0442\u044f\u0431\u0440\u044c \u041d\u043e\u044f\u0431\u0440\u044c \u0414\u0435\u043a\u0430\u0431\u0440\u044c".split(" "),s="\u043f\u043d \u0432\u0442 \u0441\u0440 \u0447\u0442 \u043f\u0442 \u0441\u0431 \u0432\u0441".split(" ").map((function(e,t){return u.a.createElement("div",{className:t<5?"c_day_name":"c_day_name_wknd",key:e},e)})),n=[],r=[],i=[],o=0;o<3;o++){n[o]=new Date(this.props.cur.getFullYear(),this.props.cur.getMonth()+o-1,1),r[o]=n[o].getMonth(),i[o]=[];for(var l=0;l<6;l++){for(var c=[],d="mw"+o+"_"+l+"_",p=function(a){var s=0===n[o].getDay()?6:n[o].getDay()-1,i=new Date(n[o].getFullYear(),r[o],1-s+7*l+a);if(i.getMonth()===r[o]){var p=a>4?"c_day c_day_wknd":"c_day";e.compareDates(i,t)&&(p+=" c_today"),e.compareDates(i,e.props.cur)&&(p+=" c_cur"),e.compareDates(i,e.dayX)&&(p+=" c_dayx"),c[a]=u.a.createElement("div",{className:p,key:d+a,onClick:function(t){return e.props.setDate(e.getStrDate(i),t)}},""+i.getDate())}else c[a]=u.a.createElement("div",{className:"c_empty",key:d+a},"\xa0")},h=0;h<7;h++)p(h);i[o][l]=u.a.createElement("div",{className:"week",key:d},c)}}return this.props.m1||j.anyMobile?u.a.createElement("div",{className:"glass"},u.a.createElement("div",{className:"calendar1m",style:this.props.leftTop,ref:function(e){return e&&e.focus()},tabIndex:"0",onKeyDown:this.keyHandler,onBlur:function(t){return e.props.setDate(0,t)}},u.a.createElement("div",{className:"month"},u.a.createElement("div",{className:"c_month"},a[r[1]]+" "+n[1].getFullYear()),u.a.createElement("div",{className:"week"},s),i[1]),u.a.createElement("div",{className:"c_arr c_left_arr",onClick:function(){e.changeCurDate(0,-1,0)}},"\u25c4"),u.a.createElement("div",{className:"c_arr c_right_arr",onClick:function(){e.changeCurDate(0,1,0)}},"\u25ba"))):u.a.createElement("div",{className:"glass"},u.a.createElement("div",{className:"calendar",style:this.props.leftTop,ref:function(e){return e&&e.focus()},tabIndex:"0",onKeyDown:this.keyHandler,onBlur:function(t){return e.props.setDate(0,t)}},u.a.createElement("div",{className:"quarter"},u.a.createElement("div",{className:"month"},u.a.createElement("div",null,a[r[0]]+" "+n[0].getFullYear()),u.a.createElement("div",{className:"week"},s),i[0]),u.a.createElement("div",{className:"month"},u.a.createElement("div",{className:"c_month"},a[r[1]]+" "+n[1].getFullYear()),u.a.createElement("div",{className:"week"},s),i[1]),u.a.createElement("div",{className:"month"},u.a.createElement("div",{className:"c_month"},a[r[2]]+" "+n[2].getFullYear()),u.a.createElement("div",{className:"week"},s),i[2])),u.a.createElement("div",{className:"c_arr c_left_arr",onClick:function(){e.changeCurDate(0,-1,0)}},"\u25c4"),u.a.createElement("div",{className:"c_arr c_right_arr",onClick:function(){e.changeCurDate(0,1,0)}},"\u25ba"),u.a.createElement("div",{className:"c_help"},"PgUp, PgDown - \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043c\u0435\u0441\u044f\u0446 \xa0 Home, End - \u043d\u0430\u0447\u0430\u043b\u043e, \u043a\u043e\u043d\u0435\u0446 \u043c\u0435\u0441\u044f\u0446\u0430",u.a.createElement("br",null),"\u041f\u0440\u043e\u0431\u0435\u043b - \u043d\u0430\u0439\u0442\u0438 \u0441\u0435\u0433\u043e\u0434\u043d\u044f \xa0 Enter - \u0432\u044b\u0431\u0440\u0430\u0442\u044c \u0434\u0430\u0442\u0443 \xa0 \xa0\xa0"),u.a.createElement("div",{className:"c_arr c_down_arr",onClick:function(){e.changeCurDate(-1,0,0)}},"\xa0\u25c4\xa0\u0433\u043e\u0434\xa0"),u.a.createElement("div",{className:"c_arr c_up_arr",onClick:function(){e.changeCurDate(1,0,0)}},"\xa0\u0433\u043e\u0434\xa0\u25ba\xa0")))}}]),t}(u.a.Component),P=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(i.a)(this,Object(o.a)(t).call(this,e))).setValue=function(e,t){a.m1=t,a.iniDP(e),a.forceUpdate()},a.getValue=function(e){return e?a.dd?a.dd+"."+a.mm+"."+a.styy+a.yy:"":a.dd?a.styy+a.yy+"-"+a.mm+"-"+a.dd:""},a.setFocus=function(e){a.setState({focusOn:!0}),a.dde.focus()},y()(Object(m.a)(a)),a.state={focusOn:!1,calendar:!1},a.m1=a.props.m1,a.iniDP(a.props.xValue),a}return Object(l.a)(t,e),Object(f.a)(t,[{key:"iniDP",value:function(e){if(e)if("string"===typeof e)this.setDate(e);else{var t=e.getUTCFullYear()+"-",a=e.getUTCMonth()+1;t+=(a<10?"0"+a:a)+"-",t+=((a=e.getUTCDate())<10?"0"+a:a)+"-",this.setDate(t)}else this.dd="",this.mm="",this.yy="",this.styy="20";this.waitDigit=0,this.oneDigit=!1}},{key:"setDate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;t&&(t.stopPropagation(),t.preventDefault());var a,s,n,r,i=!1;if(e)try{var o=e.trim();if("."===o.slice(2,3))a=o.slice(0,2),s=o.slice(3,5),n=o.slice(8,10),r=o.slice(6,8);else{if("-"!==o.slice(4,5))return this.state.calendar&&(this.setState({calendar:!1}),this.yye.focus()),!1;a=o.slice(8,10),s=o.slice(5,7),n=o.slice(2,4),r=o.slice(0,2)}var l=new Date(parseInt(r+n,10),parseInt(s,10)-1,parseInt(a,10));(i=l.getMonth()===parseInt(s,10)-1&&l.getDate()===parseInt(a,10)&&l.getFullYear()===parseInt(r+n,10))&&(this.dd=a,this.mm=s,this.yy=n,this.styy=r)}catch(c){}else i=!0;return this.state.calendar&&(this.setState({calendar:!1}),this.yye.focus()),i}},{key:"checkDT",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=!0;if(this.dd){var a=new Date;this.mm||(this.mm=("0"+(a.getMonth()+1).toString()).slice(-2)),this.yy||(this.yy=a.getFullYear().toString().slice(-2),this.styy="20");var s=new Date(this.styy+this.yy,parseInt(this.mm,10)-1,this.dd);t=s.getMonth()===parseInt(this.mm,10)-1&&s.getDate()===parseInt(this.dd,10)}else this.mm="",this.yy="";return t||this.audioTuk(),e&&(e.stopPropagation(),e.preventDefault()),this.forceUpdate(),t}},{key:"dtpFocus",value:function(e){e.stopPropagation(),e.preventDefault(),this.setState({focusOn:!0});var t=e.target;setTimeout((function(){t.selectionStart=0}),10),setTimeout((function(){t.selectionEnd=0}),10),this.waitDigit=0,this.oneDigit=!1}},{key:"dtpBlur",value:function(e){var t=this;if(this.setState({focusOn:!1}),!this.checkDT(e)&&!this.state.calendar){var a=e.target;setTimeout((function(){!t.state.focusOn&&a.focus()}),50)}}},{key:"dtpPaste",value:function(e){try{this.setDate(e.clipboardData.getData("text/plain"))||this.audioTuk()}catch(t){this.audioTuk()}this.checkDT(e)}},{key:"audioTuk",value:function(){var e=this;this.oneDigit||(this.setState({red:!0}),setTimeout((function(){e.setState({red:!1})}),500),this.props.doc.audiotuk&&(this.props.doc.audiotuk.pause(),this.props.doc.audiotuk.currentTime=0,this.props.doc.audiotuk.play()))}},{key:"toField",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t?e===this.dde?this.mme.focus():e===this.mme&&this.yye.focus():e===this.yye?this.mme.focus():e===this.mme&&this.dde.focus()}},{key:"dtpKeyDown",value:function(e){var t=e.keyCode;if(e.ctrlKey||e.altKey&&40!==t)this.checkDT()||(e.stopPropagation(),e.preventDefault());else{var a=j.upDown(e);if("up"===a)return this.props.doc.setFocus(this.props.myRow-1);if("down"===a)return this.props.doc.setFocus(this.props.myRow+1);if(t>=96&&t<=105)return this.kbIsDigit(t-48,e);if(t>=48&&t<=57)return e.altKey?this.checkDT(e):this.kbIsDigit(t,e);if(this.waitDigit=0,40===t||13===t)return this.checkDT(e),this.setState({calendar:!0});switch(t){case 8:case 46:if(e.target===this.dde)return this.dd="",this.checkDT(e);break;case 229:case 32:if(e.target===this.dde)return this.dd=("0"+(new Date).getDate().toString()).slice(-2),this.mm="",this.yy="",this.checkDT(e);break;case 110:case 111:case 190:case 191:this.oneDigit&&this.toField(e.target);break;case 37:e.target!==this.dde&&this.toField(e.target,!1);break;case 39:e.target!==this.yye&&this.toField(e.target);break;case 9:case 27:if(this.checkDT())return;break;case 86:if(e.ctrlKey)return;break;case 45:if(e.shiftKey)return}e.stopPropagation(),e.preventDefault()}}},{key:"kbIsDigit",value:function(e,t){var a=this,s=t.target;if(!this.dd&&s!==this.dde)return this.checkDT(t);var n,r,i,o=String.fromCharCode(e);if(s===this.yye)return 0===this.waitDigit?(this.waitDigit=1,this.yy="0"+o,setTimeout((function(){1===a.waitDigit&&(a.waitDigit=0)}),1e3)):1===this.waitDigit?(this.waitDigit=2,this.yy=this.yy[1]+o,setTimeout((function(){2===a.waitDigit&&(a.waitDigit=0)}),1e3)):2===this.waitDigit?(this.waitDigit=3,this.styy=this.yy,this.yy="0"+o,setTimeout((function(){a.waitDigit=0}),1e3)):3===this.waitDigit&&(this.yy=this.yy[1]+o,this.waitDigit=0),this.checkDT(t);var l=parseInt(o,10);if(s===this.dde?(n=3,r=31,i=this.dd):(n=1,r=12,i=this.mm),this.waitDigit){var c=10*parseInt(i,10)+l;0===c||c>r?this.audioTuk():(s===this.dde?this.dd=(c>9?"":"0")+c.toString():this.mm=(c>9?"":"0")+c.toString(),this.toField(s))}else this.oneDigit=!0,s===this.dde?this.dd="0"+o:this.mm="0"+o,l>n?this.toField(s):(this.waitDigit=11,setTimeout((function(){11===a.waitDigit&&(a.waitDigit=0)}),1e3));this.checkDT(t)}},{key:"render",value:function(){var e=this,t={className:"dd",autoComplete:"off",type:"text",onFocus:this.dtpFocus,onBlur:this.dtpBlur,onPaste:this.dtpPaste,onKeyDown:this.dtpKeyDown,onChange:function(){}},a=this.state.red?"#FFA07A":this.state.calendar?"#A0FF7A":this.state.focusOn?"#f4fdff":"white",s=null;if(this.state.calendar){var r=this.calendarDiv.getBoundingClientRect(),i=Math.round(r.top),o=Math.round(r.left),l=window.innerHeight,c=window.innerWidth;i=l-i>255?i+23:Math.max(i-225,5),o=this.m1||j.anyMobile?o-40:o<280?10:c-o>345?o-225:Math.max(c-575,10),s=u.a.createElement(U,{dayX:this.props.dayX,m1:this.m1,leftTop:{marginLeft:o,marginTop:i},setDate:function(t,a){return e.setDate(t,a)},cur:this.dd&&this.mm&&this.yy?new Date(parseInt(this.styy+this.yy,10),parseInt(this.mm,10)-1,parseInt(this.dd,10)):new Date})}return this.props.readOnly?u.a.createElement(L,{xValue:this.getValue(!0),readOnly:!0,style:Object(n.a)({},this.props.style)}):u.a.createElement("div",{style:Object(n.a)({},this.props.style)},u.a.createElement("div",{className:"tta"+(this.state.focusOn?" on-focus":""),style:Object(n.a)({},this.props.style,{background:a})},u.a.createElement("div",{className:"datePicker",title:"\u0414\u043b\u044f \u0432\u044b\u0437\u043e\u0432\u0430 \u043a\u0430\u043b\u0435\u043d\u0434\u0430\u0440\u044f \u043d\u0430\u0436\u043c\u0438\u0442\u0435 '\u0441\u0442\u0440\u0435\u043b\u043a\u0443-\u0432\u043d\u0438\u0437' \u043d\u0430 \u043a\u043b\u0430\u0432\u0438\u0430\u0442\u0443\u0440\u0435 \u0438\u043b\u0438 \u043f\u0438\u043a\u0442\u043e\u0433\u0440\u0430\u043c\u043c\u0443 \u043c\u044b\u0448\u043a\u043e\u0439",ref:function(t){return e.calendarDiv=t},style:{width:"3.1cm"}},u.a.createElement("input",Object.assign({tabIndex:"0"},t,{placeholder:"\u0434\u0434",value:this.dd,ref:function(t){return e.dde=t}})),u.a.createElement("span",{onClick:function(){return e.dde&&e.dde.focus()}},"."),u.a.createElement("input",Object.assign({tabIndex:-1},t,{placeholder:"\u043c\u043c",value:this.mm,ref:function(t){return e.mme=t}})),u.a.createElement("span",{onClick:function(){return e.mme&&e.mme.focus()}},"."),u.a.createElement("span",{onClick:function(){return e.yye&&e.yye.focus()},className:"styy",style:this.yy?{color:"black"}:{}},this.styy),u.a.createElement("input",Object.assign({tabIndex:-1},t,{placeholder:"\u0433\u0433",value:this.yy,ref:function(t){return e.yye=t}})),u.a.createElement("span",{onClick:function(){return e.yye&&e.yye.focus()}},"\xa0"),u.a.createElement("div",{className:"dtp",onClick:function(){return e.setState({calendar:!0})}},u.a.createElement("div",{className:"dtp1"}),u.a.createElement("div",{className:"dtp2"},("0"+(new Date).getDate().toString()).slice(-2))),s)))}}]),t}(u.a.Component),M=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(i.a)(this,Object(o.a)(t).call(this,e))).setValue=function(e){return a.setState({text:e||""})},a.getValue=function(e){return a.state.text},a.state={text:a.props.xValue||""},a}return Object(l.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){return u.a.createElement("div",{style:Object(n.a)({},this.props.style),className:this.props.className},E.splitText(this.state.text,this.props))}}]),t}(u.a.Component),A=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(i.a)(this,Object(o.a)(t).call(this,e))).setValue=function(e){return a.setState({cells:e.split("\n")})},a.getValue=function(e){return a.state.cells.join("\n")},y()(Object(m.a)(a)),a.state={cells:a.props.xValue.split("\n")},a}return Object(l.a)(t,e),Object(f.a)(t,[{key:"delValue",value:function(e,t){e.stopPropagation(),this.setState({cells:this.state.cells.filter((function(e,a){return t!==a}))}),j.recalc(this,null,t)}},{key:"render",value:function(){var e,t=this,a=this.state.cells;if(a.length&&a[0]){e=[];for(var s=this.props.btn[0],r=0,i=this.props.btn[1],o=0;o<Math.floor(a.length/s)+1;o++){for(var l=[],c=function(e){var s=r,n=t.props.readOnly?u.a.createElement("span",{className:"delBtnR"},"\xa0"):u.a.createElement("span",{className:"delBtn",title:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c",onClick:function(e){return t.delValue(e,s)}},"\xd7");if("gr"===t.props.field[1]){var o=j.partition(a[r],"|"),c=Object(h.a)(o,2),d=c[0],p=c[1];l[e]=u.a.createElement("div",{key:r,className:"ground",style:{minWidth:i,maxWidth:i},onClick:function(e){return t.props.doc.dlgPreview.docPreview(p,t.props.doc)}},n,d)}else l[e]=u.a.createElement("div",{key:r,className:"ask",style:{minWidth:i,maxWidth:i}},n,a[r])},d=0;d<s&&r<a.length;d++,r++)c(d);e[o]=u.a.createElement("div",{key:o,className:"grTable"},l)}}else e=u.a.createElement("div",{className:"grTable",style:{paddingTop:4}},"\xa0");return u.a.createElement("div",{style:Object(n.a)({},this.props.style)},u.a.createElement("div",{tabIndex:"1",className:"tta",style:Object(n.a)({padding:"1px 0 1px 1px"},this.props.ttaStyle)},e))}}]),t}(u.a.Component),I=function(e){function t(e){var a;Object(r.a)(this,t),(a=Object(i.a)(this,Object(o.a)(t).call(this,e))).showDlg=function(e){var t,s,n=a.props.doc;if("F"===a.status)return t=n.getField("status_fd"),s=n.getField("notes_fd")||a.notes,a.runXhrHourSave(t,s);var r=a.status;"m"===(t=a.status.toLowerCase())&&(t="a"),n.dlg.show("".concat(a.props.j+1,".").concat(("0"+(a.props.mm+1)).slice(-2),".").concat(a.props.yy," ").concat(a.props.r+11,":00"),{status:t,userName:a.uNamePhone,notes:a.notes},{style:{position:"fixed",zIndex:1e3,width:250,top:"calc(100vh / 2 - 90px)",left:"calc(100vw / 2 - 90px)",height:215,overflow:"hidden"},buttons:["OK+|Y","\u043e\u0442\u043c\u0435\u043d\u0430"],cmButton:function(e){a.enable?(t=(t=n.dlg.getField("status").split("|")[0]||"F")===r.toLowerCase()?r:t,s=n.dlg.getField("notes"),t===a.status&&s===a.notes||a.runXhrHourSave(t,s)):alert("\u041d\u0435\u043b\u044c\u0437\u044f \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0447\u0443\u0436\u0443\u044e \u0430\u0440\u0435\u043d\u0434\u0443")}},{width:240,height:150},JSON.parse(n.getField("cellProps_fd")),null,null,null,"dlgButtons2")},a.afterSave=function(e,t){a.status=e,a.uNamePhone=a.uName=a.userName,a.uName2=j.partition(a.uName,"/")[0],a.notes=t,a.props.setCell(a.props.i,[e,a.uNamePhone,t]),a.setState({status:e})},a.render=function(e){var t=new Date(a.props.yy,a.props.mm,a.props.j+1);a.cl=j.anyMobile?"cell":"bigCell",a.cl+=a.props.c13||t.getTime()!==(new Date).setHours(0,0,0,0)?" ":" b",a.classN=a.cl+(a.userName2===a.uName2&&"F"!==a.status?"m"+a.status:a.status);var s=j.anyMobile?"":":00";a.props.c13?a.label=a.props.r+11+s:t.getDay()?a.label="":a.label=a.props.r+11+s;var n=j.anyMobile?"":u.a.createElement("span",null,u.a.createElement("br",null),a.notes||"",u.a.createElement("br",null),a.uName||"");return u.a.createElement("div",{className:a.classN,onClick:a.showDlg},a.label,n)},y()(Object(m.a)(a)),a.status=a.props.value[0]||"F",a.uNamePhone=(a.props.value[1]||"").toString(),a.notes=(a.props.value[2]||"").toString(),a.userName=a.props.doc.props.userName,a.userName2=j.partition(a.userName,"/")[0],a.uName=j.partition(a.uNamePhone,"\n")[0],a.uName2=j.partition(a.uName,"/")[0];var s=a.notes.toLowerCase().trim();return a.status&&(a.userName2===a.uName2||"\u041d\u043e\u0432\u044b\u0439 \u0412\u0435\u043a"!==a.uName2||s&&!s.includes("\u043e\u0442\u043f\u0443\u0441\u043a"))||(a.status="F"),a.enable="F"===a.status||a.userName2===a.uName2,a.state={status:a.status},a}return Object(l.a)(t,e),Object(f.a)(t,[{key:"runXhrHourSave",value:function(e,t){var a=this,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=e+"|"+t,r="/saveHour?".concat(this.props.dKey,"_").concat(this.props.j+1,"_").concat(this.props.r+11,"_").concat(s);fetch(r,{method:"post",body:n,credentials:"include"}).then((function(s){409===s.status?s.text().then((function(s){return a.props.doc.msg.box("\u041f\u0415\u0420\u0415\u0417\u0410\u041f\u0418\u0421\u0410\u0422\u042c \u0414\u041e\u041a\u0423\u041c\u0415\u041d\u0422?\n"+s,"\u041a\u043e\u043d\u0444\u043b\u0438\u043a\u0442 \u043f\u0440\u0438 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0438",["\u0414\u0430+|Y","\u041d\u0435\u0442"]).then((function(s){return a.runXhrHourSave(e,t,"force")}))})).catch((function(e){return alert("\u041a\u043e\u043d\u0444\u043b\u0438\u043a\u0442 \u043f\u0440\u0438 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0438")})):200!==s.status?alert("DocSave-error-status ".concat(s.status,"\nurl:").concat(r)):a.afterSave(e,t)})).catch((function(e){return alert("DocSave-error:".concat(e,"\n\nurl:").concat(r))}))}}]),t}(u.a.Component),R=function(e){function t(e){var a;Object(r.a)(this,t),(a=Object(i.a)(this,Object(o.a)(t).call(this,e))).componentDidMount=function(e){a.noLoad||a.cells||a.waitLoad||j.hide(a.props.doc,a.props.name)||(a.waitLoad=!0,a.loadTable())},a.shouldComponentUpdate=function(e,t){return a.noLoad||a.cells||a.waitLoad||j.hide(a.props.doc,a.props.name)||(a.waitLoad=!0,a.loadTable()),!0},a.setCell=function(e,t){return a.cells[e]=t},a.onclick=function(e){var t=a.props.doc,s=parseInt(t.getField("show_FD"),10);if(!(1===s&&e<0||10===s&&e>0)){var n=parseInt(t.getField("nRooms_FD"),10);Object.keys(t.register).forEach((function(s){if(t.register[s].props.showCol===a.props.showCol){var r=parseInt(j.partition(s,"_")[1],10),i=r+e*n;window.showRooms[i]=window.showRooms[r],window.showRooms[r]=!1,t.register["SCH_"+i.toString()].noLoad=t.register[s].noLoad}})),t.setField("show_FD",(s+e).toString()),t.forceUpdate()}},y()(Object(m.a)(a));var s=a.props.header.split("|"),n=Object(h.a)(s,5);a.title=n[0],a.url=n[1],a.rType=n[2],a.month=n[3],a.dKey=n[4];var l=a.dKey.split("_");return a.mm=parseInt(l[1],10)-1,a.yy=parseInt(l[2],10),a.state={spinner:!1},a.props.doc.roomsLoad=a.props.doc.roomsLoad||[],a.noLoad=!0,a}return Object(l.a)(t,e),Object(f.a)(t,[{key:"loadTable",value:function(){var e=this;if(!this.err){var t=j.partition(this.props.xName,"_")[1],a=parseInt(t,10)-1;this.props.doc.roomsLoad[t]=!0,this.props.doc.roomsLoad[a]?setTimeout(this.loadTable,25):(setTimeout((function(t){return e.waitLoad?e.setState({spinner:!0}):0}),500),this.forceUpdate(),j.jsonByUrl("api.get?loadMonth&"+this.dKey).then((function(a){e.waitLoad=!1,e.props.doc.setField(e.props.xName+"_key",e.dKey),e.cells=a.slice(),e.setState({spinner:!1}),e.props.doc.roomsLoad[t]=!1})).catch((function(a){e.err=e.props.xName+": "+e.dKey+": "+a,console.log(a),e.setState({spinner:!1}),e.props.doc.roomsLoad[t]=!1,e.waitLoad=!1})))}}},{key:"render",value:function(){var e,t,a,s=this,r=this.props.doc;r.state.class_fd&&(a=r.getField("date_fd"))&&(e=r.state.class_fd,t=a.split("-")[2],t=parseInt(t,10));var i,o=null,l=this.cells;if(!this.noLoad&&l&&l.length&&l[0]){i=[];var c,d,p=this.props.btn,h=0,f=[],m=[];for(c=0;c<p;c++)e?t===c+1&&(f[c]=u.a.createElement("div",{key:c,style:{transform:"rotate(270deg)"},className:"cellDay"},j.partition(this.title,"\xa0")[0])):f[c]=u.a.createElement("div",{key:c,className:j.anyMobile?"cellDay":"bigCellDay"},c+1);for(i[0]=u.a.createElement("div",{key:"row1",className:"schTable"},f),d=0;d<Math.floor(l.length/p)+1;d++){for(m=[],c=0;c<p&&h<l.length;c++,h++)e&&t!==c+1||(m[c]=u.a.createElement(I,{c13:e,key:h,i:h,value:l[h],r:d,j:c,doc:r,mm:this.mm,yy:this.yy,dKey:this.dKey,setCell:this.setCell}));i[d+1]=u.a.createElement("div",{key:d,className:"schTable"},m)}i[d]=u.a.createElement("div",{key:"row2",className:"schTable"},f)}else i=" ",o=u.a.createElement("div",{className:"btn",onClick:function(e){return j.runCmd(r,"loadRoom",s)}},"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c");var v="1"!==r.getField("show_FD"),y="10"!==r.getField("show_FD"),g=this.waitLoad&&this.state.spinner,w=u.a.createElement("div",{style:{width:120,padding:"0 10px",display:"table-cell",color:"blue",font:"normal 14px Verdana",letterSpacing:1}},this.title),k=g||e?null:u.a.createElement("div",{style:{margin:"auto",display:"table",paddingTop:5}},o,w,u.a.createElement("div",{className:"exp",style:v?{}:{cursor:"default"},onClick:function(e){return v&&s.onclick(-1)}},v&&String.fromCharCode(9668)),u.a.createElement("div",{className:"chMonth"},this.month),u.a.createElement("div",{className:"exp",style:y?{}:{cursor:"default"},onClick:function(e){return y&&s.onclick(1)}},y&&String.fromCharCode(9658)),o||w);return u.a.createElement("div",{style:Object(n.a)({},this.props.style),className:g?"norows":e||"shRow"},k,g?b(!1,!1):this.err?this.err:i)}}]),t}(u.a.Component),K=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(i.a)(this,Object(o.a)(t).call(this,e))).getValue=function(e){return a.state.isChecked?"1":""},a.setValue=function(e){a.setState({isChecked:!!e}),j.recalc(Object(m.a)(a),!!e)},a.onchange=function(e){j.recalc(Object(m.a)(a),!a.state.isChecked),a.setState({isChecked:!a.state.isChecked})},y()(Object(m.a)(a)),a.state={isChecked:!!a.props.xValue},a}return Object(l.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){var e=this;return this.props.classic?u.a.createElement("div",{className:this.props.className,style:Object(n.a)({},this.props.style),title:this.props.title},u.a.createElement("input",{style:{cursor:"pointer"},type:"checkbox",id:this.props.xName,checked:this.state.isChecked,disabled:this.props.readOnly,onChange:this.onchange}),u.a.createElement("label",{htmlFor:this.props.xName,style:{cursor:"pointer"}},this.props.ls||"")):u.a.createElement("div",{className:this.props.className,style:Object(n.a)({textAlign:"left"},this.props.style),title:this.props.title},u.a.createElement("input",{type:"checkbox",className:" checkbox",id:this.props.xName,checked:this.state.isChecked,disabled:this.props.readOnly,onChange:function(){j.recalc(e,!e.state.isChecked),e.setState({isChecked:!e.state.isChecked})}}),u.a.createElement("label",{htmlFor:this.props.xName},this.props.ls||""))}}]),t}(u.a.Component),W=function(e){function t(e){var a;Object(r.a)(this,t),(a=Object(i.a)(this,Object(o.a)(t).call(this,e))).getValue=function(e){return a.state.value<0?a.valL:a.state.value?a.valR:""},a.setValue=function(e){var t=e===a.valL?-1:e===a.valR?1:0;a.setState({value:t}),j.recalc(Object(m.a)(a),a.getValue())},a.setEmpty=function(e){a.props.noEmpty||(j.recalc(Object(m.a)(a),""),a.setState({value:0}))},y()(Object(m.a)(a));var s=0;try{var n=j.partition(a.props.ls[0],"|"),l=Object(h.a)(n,2);a.labL=l[0],a.valL=l[1];var c=j.partition(a.props.ls[1],"|"),u=Object(h.a)(c,2);a.labR=u[0],a.valR=u[1],a.valL=a.valL||a.labL,a.valR=a.valR||a.labR,a.props.xValue===a.valL?s=-1:a.props.xValue===a.valR&&(s=1)}catch(d){a.labL=a.valL=-1,a.labR=a.valR=1}return a.state={value:s},a}return Object(l.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){var e=this,t=this.state.value<0?"chb3a":"chb3b",a=this.state.value>0?"chb3a":"chb3b",s=this.state.value?"chb3bc":"chb3ac";return u.a.createElement("div",{className:this.props.className||"chb3",style:Object(n.a)({},this.props.style),title:this.props.title},u.a.createElement("div",{onClick:function(t){j.recalc(e,e.valL),e.setState({value:-1})}},u.a.createElement("div",{className:t,style:{textAlign:"right"}},this.labL+"\xa0",u.a.createElement("div",{style:{float:"right"}},"|"))),u.a.createElement("div",{style:{width:20},onClick:this.setEmpty},u.a.createElement("div",{className:s},"\xa0")),u.a.createElement("div",{onClick:function(t){j.recalc(e,e.valR),e.setState({value:1})}},u.a.createElement("div",{className:a,style:{textAlign:"left"}},u.a.createElement("div",{style:{float:"left"}},"|"),"\xa0"+this.labR)))}}]),t}(u.a.Component),z=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(i.a)(this,Object(o.a)(t).call(this,e))).setValue=function(e){return a.setState({list:e})},y()(Object(m.a)(a)),a.state={list:a.props.readyList||"[]"},a}return Object(l.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){var e,t=this;try{e=JSON.parse(this.state.list)}catch(r){e=[]}var a=e.map((function(e,a){var s=re(e,t.props.doc),r=Object(h.a)(s,3),i=r[0],o=r[1],l=r[2];return u.a.createElement("div",{key:e[0],className:l,style:Object(n.a)({display:"table-row"},o)},i)})),s=a.length?{background:"rgba(255,255,255, 0.5)",transition:"background 2.0s ease"}:{};return u.a.createElement("div",{style:Object(n.a)({width:"100%",display:"table",tableLayout:"fixed"},s)},a)}}]),t}(u.a.Component),Y=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(i.a)(this,Object(o.a)(t).call(this,e))).componentWillReceiveProps=function(e){a.setState({expand:e.expand||a.state.expand})},a.setExpand=function(e){e.stopPropagation(),a.setState({expand:!a.state.expand})},y()(Object(m.a)(a)),a.state={expand:a.props.expand},a}return Object(l.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){var e,t,a=this;this.props.refsDocs?(e=this.state.expand?"\u25bc":"\u25ba",t={display:"table-cell",cursor:"pointer"}):(e="\xa0",t={display:"table-cell",cursor:"default"});var s=u.a.createElement("div",{key:9998,style:t,className:"expClass",onClick:function(e){return a.props.refsDocs?a.setExpand(e):0}},e),r=re(this.props.mainDoc,this.props.doc),i=Object(h.a)(r,3),o=i[0],l=i[1],c=i[2];o.unshift(s);var d=u.a.createElement("div",{key:this.props.mainDoc[0],className:c||"mRow"+(this.props.selectedDoc===this.props.mainDoc[0]?" selectedDoc":""),style:Object(n.a)({},l),onClick:function(e){return a.props.rowClick(a.props.mainDoc[0])}},o);if(!this.props.refsDocs||!this.state.expand)return d;var p=this.props.refsDocs.map((function(e,t){var s=re(e,a.props.doc),r=Object(h.a)(s,3);return o=r[0],l=r[1],c=r[2],o.unshift(u.a.createElement("div",{key:9998,style:{width:16,display:"table-cell"}})),u.a.createElement("div",{key:e[0],className:(c||"rRow")+(a.props.selectedDoc===e[0]?" selectedDoc":""),onClick:function(t){return a.props.rowClick(e[0])},style:Object(n.a)({},l)},o)}));return u.a.createElement("div",{style:{display:"table-row-group"}},d,p)}}]),t}(u.a.Component),H=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(i.a)(this,Object(o.a)(t).call(this,e))).componentDidMount=function(e){return a.loadView()},a.setValue=function(e,t){var s=(t||"").split("|"),n=Object(h.a)(s,4),r=n[0],i=n[1],o=n[2],l=n[3];a.filtered=e||"",a.offset=r||"0",a.limit=i||"50",a.dbAlias=o||a.dbAlias,a.viewClass=l||a.viewClass,a.loadView()},a.getValue=function(e){return a.dbAlias+"&"+a.selectedDoc},a.rowClick=function(e){a.selectedDoc=e,a.forceUpdate()},y()(Object(m.a)(a)),a.state={spinner:!1},a.mainDocs=[],a.refsDocs=[],a.viewStyle=a.props.viewStyle||{},a.filtered=a.props.filtered||"",a.offset=a.props.offset||"0",a.limit=a.props.limit||"50",a.dbAlias=a.props.dbAlias||a.props.doc.dbAlias,a.viewClass=a.props.viewClass,a}return Object(l.a)(t,e),Object(f.a)(t,[{key:"loadView",value:function(){var e=this;this.waitLoad=!0,this.header=null,setTimeout((function(t){return e.waitLoad?e.setState({spinner:!0}):0}),1e3),this.viewStyle=Object(n.a)({},this.viewStyle,{opacity:.2,transition:"opacity 50ms ease"}),this.forceUpdate();var t=["api.get?loadView",this.dbAlias,this.props.xName,this.viewClass,this.offset,this.limit,this.filtered].join("&");window.owlDebug&&console.log("Debug View.js:",t),j.jsonByUrl(t).then((function(t){e.mainDocs=t.mainDocs,e.refsDocs=t.refsDocs,e.waitLoad=!1,e.viewStyle=Object(n.a)({},e.viewStyle,{opacity:1,transition:"opacity 0.4s ease"}),e.selectedDoc=e.mainDocs&&e.mainDocs.length&&e.mainDocs[0][0],e.setState({i:0,spinner:!1});var a=e.selectedDoc?e.dbAlias+"&"+e.selectedDoc:"";if(j.runCmd(e.props.doc,"viewLoaded",e.props.xName+"|"+a),t.setField){var s=j.partition(t.setField,"|"),r=Object(h.a)(s,2),i=r[0],o=r[1];e.props.doc.setField(i,o)}})).catch((function(a){alert("loadView-error:"+a),console.log("loadView-error:",t,a),e.waitLoad=!1,e.viewStyle=Object(n.a)({},e.viewStyle,{opacity:1}),e.setState({i:0,spinner:!1})}))}},{key:"render",value:function(){var e=this;if(this.waitLoad&&this.state.spinner)return u.a.createElement("div",{style:{width:this.viewStyle.width,height:"90%",position:"relative"}},b(!1,!1,"preloaderColor"));var t=this.mainDocs.map((function(t){return u.a.createElement(Y,{key:t[0],mainDoc:t,refsDocs:e.refsDocs&&e.refsDocs[t[0]],expand:e.selectedDoc===t[0],doc:e.props.doc,dbAlias:e.props.doc.dbAlias,rowClick:e.rowClick,selectedDoc:e.selectedDoc})}));return u.a.createElement("div",{style:Object(n.a)({width:"100%",display:"table",tableLayout:"fixed"},this.viewStyle)},t)}}]),t}(u.a.Component),J=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(i.a)(this,Object(o.a)(t).call(this,e))).getValue=function(e){return a.textOrObj},a.setValue=function(e,t){a.textOrObj=e,a.kkey=t||0,a.readOnly=t?"edit"!==a.props.doc.rsMode:a.props.readOnly,a.forceUpdate()},a.render=function(e){var t=null;if(a.textOrObj)if("string"===typeof a.textOrObj)try{t=JSON.parse(a.textOrObj)}catch(s){t=[{div:"Error in field JSON(".concat(a.props.xName,")\n").concat(s.name,": ").concat(s.message),br:1,style:{color:"red"}},{div:a.textOrObj}]}else t=a.textOrObj;return u.a.createElement("div",{style:Object(n.a)({},a.props.style),className:a.props.className},t&&re(t,a.props.doc,a.readOnly,0,0,a.kkey)[0])},a.textOrObj=a.props.xValue,a.kkey=0,a.readOnly=a.props.readOnly,a}return Object(l.a)(t,e),t}(u.a.Component),X=0,G={},q=function(e){function t(e){var a;Object(r.a)(this,t),(a=Object(i.a)(this,Object(o.a)(t).call(this,e))).getValue=function(e){return a.equ(a.oldSvg,a.newBox)?a.props.doc.fieldValues[a.props.xName]:JSON.stringify(a.svgBoxToField(a.newBox))},a.svgBoxToField=function(e){for(var t={_teg:e.props._teg,attributes:{},setting:{}},s=0,n=["id","x","y","w","h"];s<n.length;s++){var r=n[s];(e[r]||0===e[r])&&(t.attributes[r]=e[r].toString())}for(var i in e.setting)t.setting[i]=e.setting[i];if(e.tree){var o=[];e.tree.forEach((function(e){return(!e.state||!e.state.deleted)&&o.push(a.svgBoxToField(e))})),o.length&&(t.children=o)}return t},a.render=function(e){return a.oldSvg?u.a.createElement(Z,Object.assign({doc:a.props.doc},a.oldSvg.attributes,{setting:a.oldSvg.setting,children:a.oldSvg.children,ref:function(e){a.newBox=e},style:a.props.style,onKeyDown:a.handleKeyDown,_teg:"svgBox"})):a.errBox},y()(Object(m.a)(a));try{a.oldSvg=JSON.parse(a.props.xValue)}catch(s){console.log("Svg.js.JSON.parse",a.props.xValue,typeof a.props.xValue),a.oldSvg=null,a.errBox=u.a.createElement("div",{style:{color:"red"}},"\u041e\u0448\u0438\u0431\u043a\u0430 \u0432 \u043f\u043e\u043b\u0435 SVG",u.a.createElement("br",null),s.name+": "+s.message)}return window.onkeydown=a.handleKeyDown,a}return Object(l.a)(t,e),Object(f.a)(t,[{key:"equ",value:function(e,t){if((!t.state||!t.state.delete)&&e.attributes.id===t.id&&E.cmpObj(e.setting,t.setting)){for(var a=0,s=["x","y","w","h"];a<s.length;a++){var n=s[a];if("number"===typeof t[n]){if(e.attributes[n]!==t[n].toString())return}else if(e.attributes[n])return}if(!!e.children===!!t.tree){if(t.tree)for(var r=0;r<t.tree.length;r++)if(!this.equ(e.children[r],t.tree[r]))return;return!0}}}},{key:"handleKeyDown",value:function(e){if(!(this.props.doc.waitSave||"preview"===this.props.doc.rsMode||this.props.doc.msg.state.isOpen||this.props.doc.dlg.state.isOpen||this.props.doc.dlgPreview.state.isOpen||this.props.doc.getField("_page_"))){switch(e.keyCode){case 83:if(!this.props.doc.state.readOnly&&e.ctrlKey){this.props.doc.cmdSave(!1);break}return;case 27:this.props.doc.closeDoc(e.shiftKey);break;case 80:if(e.ctrlKey){this.props.doc.cmdSave(null,!0);break}return;default:return}e.stopPropagation(),e.preventDefault()}}}]),t}(u.a.Component),Z=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(i.a)(this,Object(o.a)(t).call(this,e))).appendChild=function(e){var s="api.get?insertSvgItem&".concat(a.props.doc.dbAlias,"&").concat(e),r="main"===a.id?400:a.w>40?a.w-20:30,i="main"===a.id?160:a.h>40?a.h-20:30;E.jsonByUrl(s).then((function(e){var s=u.a.createElement(t,{key:Math.random(),id:"box",svg:Object(m.a)(a),_teg:"svgBox",x:7,y:7,w:r,h:i,setting:Object(n.a)({},e.setting),children:e.children,tree:a.tree,doc:a.props.doc,sendShow:!0}),o=(a.state.svgBox||[]).slice();o.push(s),a.setState({svgBox:o})})).catch((function(e){return console.error("Svg.js.appendChild: Util.jsonByUrl(".concat(s,"):").concat(e))}))},a.componentDidMount=function(e){a.sendShow&&E.runCmd(a.props.doc,"sendShow"),a.sendShow=!1},a.contextMenu=function(e){if(e.target.id){var t=E.partition(e.target.id,"__")[0];("main"===t||t.startsWith("box_"))&&E.runCmd(a.props.doc,"contextMenu",{event:e,dom:a.dom.current,box:G[t]||Object(m.a)(a)})}e.preventDefault(),e.stopPropagation()},a.mouseDown=function(e){if(e.target.id)if(a.props.doc.contextMenu)a.props.doc.contextMenu=!1,a.props.doc.forceUpdate();else{a.ctm=a.dom.current.getScreenCTM(),a.pt=a.dom.current.createSVGPoint(),a.pt0=a.dom.current.createSVGPoint(),a.pt0.x=e.clientX,a.pt0.y=e.clientY,a.pt0=a.pt0.matrixTransform(a.ctm.inverse());var t=E.partition(e.target.id,"__"),s=Object(h.a)(t,2);a.clickedId=s[0],a.type=s[1],a.type=a.type||E.partition(a.clickedId,"_")[0],a.current=G[a.clickedId],a.owner=a.current&&a.current.props.svg}else a.clickedId=null,a.type=null;e.preventDefault(),e.stopPropagation()},a.setProprty=function(e){return window.setSvgBoxProprty(a.props.doc,Object(m.a)(a))},a.render=function(e){if(a.state.deleted)return null;if(!a.props.svg)return u.a.createElement("svg",Object.assign({x:0,y:0,style:Object(n.a)({},a.props.style)},a.mouse,{ref:a.dom,id:a.id}),u.a.createElement("text",{cursor:"pointer",onClick:a.setProprty,x:"2",y:"20",fill:"#a40",fontSize:"10pt",fontFamily:"verdana",style:{background:"#def"}},"page"),a.state.svgBox,u.a.createElement("circle",{id:a.id+"__P",onClick:a.pasteItem,cx:15,cy:45,r:7,fill:"#0f8",cursor:"pointer"},u.a.createElement("title",null,"paste item")));var t=a.w+2*a.rr,r=a.h+2*a.rr,i=a.x-a.rr,o=a.y-a.rr,l=a.w+a.rr,c=a.h+a.rr,d=a.w/2+a.rr,p=a.h/2+a.rr,h="M ".concat(a.rr," ").concat(a.rr," H ").concat(l," V ").concat(c," H ").concat(a.rr," Z"),f="div"===a.setting.type?"blue":"green",m=a.id+": "+a.setting.type,v=a.setting.text?u.a.createElement("text",{cursor:"pointer",onClick:a.setProprty,x:"10",y:"20",fill:"#888",fontSize:"10pt",fontFamily:"verdana",style:{background:"#def"}},a.setting.text.substr(0,80),u.a.createElement("title",null,"property")):null;return u.a.createElement("svg",Object.assign({x:i,y:o,width:t,height:r,fill:"rgba(255,255,255, 0.8)",cursor:a.cursor},a.mouse,{id:a.id}),u.a.createElement("path",{id:a.id+"__R0",d:h,stroke:f}),v,u.a.createElement("text",{cursor:"pointer",onClick:a.setProprty,x:"10",y:c-5,fill:"#a40",fontSize:"10pt",fontFamily:"verdana",style:{background:"#def"}},m,u.a.createElement("title",null,"property")),u.a.createElement("circle",Object.assign({id:a.id+"__1",cx:a.rr,cy:a.rr},a.attrCirc,{cursor:"nwse-resize"})),u.a.createElement("circle",Object.assign({id:a.id+"__2",cx:l,cy:a.rr},a.attrCirc,{cursor:"nesw-resize"})),u.a.createElement("circle",Object.assign({id:a.id+"__3",cx:l,cy:c},a.attrCirc,{cursor:"nwse-resize"})),u.a.createElement("circle",Object.assign({id:a.id+"__4",cx:a.rr,cy:c},a.attrCirc,{cursor:"nesw-resize"})),u.a.createElement("circle",Object.assign({id:a.id+"__5",cx:d,cy:a.rr},a.attrCirc,{cursor:"n-resize"})),u.a.createElement("circle",Object.assign({id:a.id+"__6",cx:l,cy:p},a.attrCirc,{cursor:"e-resize"})),u.a.createElement("circle",Object.assign({id:a.id+"__7",cx:d,cy:c},a.attrCirc,{cursor:"n-resize"})),u.a.createElement("circle",Object.assign({id:a.id+"__8",cx:a.rr,cy:p},a.attrCirc,{cursor:"e-resize"})),u.a.createElement("circle",{id:a.id+"__C",onClick:function(e){return s=a.id},cx:l-30,cy:c-10,r:7,fill:"#08f",cursor:"pointer"},u.a.createElement("title",null,"copy item")),u.a.createElement("circle",{id:a.id+"__P",onClick:a.pasteItem,cx:l-10,cy:c-10,r:7,fill:"#0f8",cursor:"pointer"},u.a.createElement("title",null,"paste item")),u.a.createElement("circle",{id:a.id+"__D",onClick:a.deleteItem,cx:l-10,cy:15,r:7,fill:"#f80",cursor:"pointer"},u.a.createElement("title",null,"delete item")),u.a.createElement("animate",{xlinkHref:"#"+a.id+"__C",attributeName:"r",from:"7",to:"50",dur:"0.2s",begin:"click",fill:"freeze"}),u.a.createElement("animate",{xlinkHref:"#"+a.id+"__C",attributeName:"r",from:"50",to:"7",dur:"0.2s",begin:"click+0.2s",fill:"freeze"}),u.a.createElement("animate",{xlinkHref:"#"+a.id+"__P",attributeName:"r",from:"7",to:"50",dur:"0.2s",begin:"click",fill:"freeze"}),u.a.createElement("animate",{xlinkHref:"#"+a.id+"__P",attributeName:"r",from:"50",to:"7",dur:"0.2s",begin:"click+0.2s",fill:"freeze"}),a.state.svgBox)},a.deleteItem=function(e){a.props.doc.msg.box('Delete item "'.concat(a.id,'" ?'),"Warning",["Delete+|Y","Cancel"]).then((function(e){a.props.svg.tree.forEach((function(e){return e===Object(m.a)(a)&&a.setState({deleted:!0})})),setTimeout((function(e){return E.runCmd(a.props.doc,"sendShow")}),100)})).catch((function(e){}))},a.pasteItem=function(e){if(s){if(!["div","form","span","b","i","p","ol","ul","a","label"].includes(a.setting.type)&&"main"!==a.id)return a.props.doc.msg.box("You can paste an item in the div. Box: "+a.setting.type,"warning");var r=G[s],i="main"===a.id?r.w:Math.min(r.w,a.w-16),o="main"===a.id?r.h:Math.min(r.h,a.h-16),l=u.a.createElement(t,{key:Math.random(),id:"box",svg:Object(m.a)(a),_teg:"svgBox",x:8,y:8,w:i,h:o,setting:Object(n.a)({},r.setting),children:(r.props.children||[]).slice(),tree:a.tree,doc:a.props.doc,sendShow:!0}),c=(a.state.svgBox||[]).slice();c.push(l),a.setState({svgBox:c})}},y()(Object(m.a)(a)),a.setting=Object(n.a)({},a.props.setting),a.sendShow=a.props.sendShow,a.r=4,a.rr=a.r+1,a.x=parseInt(a.props.x,10)||0,a.y=parseInt(a.props.y,10)||0,a.w=parseInt(a.props.w,10)||20,a.h=parseInt(a.props.h,10)||20,a.svg=Object(m.a)(a),a.tree=[],a.props.tree&&a.props.tree.push(Object(m.a)(a)),a.props.svg?(X++,a.id="box_"+X,G[a.id]=Object(m.a)(a),a.cursor="move",a.attrCirc={r:a.r,fill:"white",stroke:"div"===a.setting.type?"blue":"green",strokeWidth:"1"}):(a.props.doc.mainSvg=Object(m.a)(a),a.id="main",a.dom=u.a.createRef(),a.mouse={onMouseMove:function(e){return a.mouseMove(e)},onMouseDown:function(e){return a.mouseDown(e)},onMouseUp:function(e){return a.mouseUp(e)},onContextMenu:function(e){return a.contextMenu(e)}}),a.state={svgBox:ee(Object(m.a)(a),a.props.children)},a}return Object(l.a)(t,e),Object(f.a)(t,[{key:"mouseMove",value:function(e){if(1===e.buttons&&this.type&&this.owner){this.pt.x=e.clientX,this.pt.y=e.clientY,this.pt=this.pt.matrixTransform(this.ctm.inverse());var t=this.pt.x-this.pt0.x,a=this.pt.y-this.pt0.y;switch(this.type){case"HL":this.current.y+=a,this.current.forceUpdate();break;case"VL":this.current.x+=t,this.current.forceUpdate();break;case"R0":this.current.x+=t,this.current.y+=a,this.current.forceUpdate();break;case"1":this.current.w=Math.max(this.current.w-t,3),this.current.h=Math.max(this.current.h-a,3),this.current.x+=t,this.current.y+=a,this.current.forceUpdate();break;case"2":this.current.w=Math.max(this.current.w+t,3),this.current.h=Math.max(this.current.h-a,3),this.current.y+=a,this.current.forceUpdate();break;case"3":this.current.w=Math.max(this.current.w+t,3),this.current.h=Math.max(this.current.h+a,3),this.current.forceUpdate();break;case"4":this.current.w=Math.max(this.current.w-t,3),this.current.h=Math.max(this.current.h+a,3),this.current.x+=t,this.current.forceUpdate();break;case"5":this.current.h=Math.max(this.current.h-a,3),this.current.y+=a,this.current.forceUpdate();break;case"6":this.current.w=Math.max(this.current.w+t,3),this.current.forceUpdate();break;case"7":this.current.h=Math.max(this.current.h+a,3),this.current.forceUpdate();break;case"8":this.current.w=Math.max(this.current.w-t,3),this.current.x+=t,this.current.forceUpdate()}this.pt0.x=this.pt.x,this.pt0.y=this.pt.y,this.forceUpdate(),e.preventDefault(),e.stopPropagation()}}},{key:"mouseUp",value:function(e){this.type=null,this.forceUpdate(),e.preventDefault(),e.stopPropagation(),E.runCmd(this.props.doc,"sendShow")}}]),t}(u.a.Component),$=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(i.a)(this,Object(o.a)(t).call(this,e))).render=function(e){return u.a.createElement("svg",{x:a.x,y:a.y,cursor:a.cursor},u.a.createElement("line",{strokeWidth:2,strokeDasharray:7,x1:2,y1:2,style:{stroke:"#ccc"},x2:a.x2,y2:a.y2}),u.a.createElement("line",{strokeWidth:2,strokeDasharray:7,x1:a.x1,y1:a.y1,x2:a.x2,y2:a.y2,style:{stroke:"#777"}}),u.a.createElement("rect",{id:a.id,x:0,y:0,fill:"transparent",width:a.w,height:a.h}))},y()(Object(m.a)(a)),X++,a.x=parseInt(a.props.x||0,10),a.y=parseInt(a.props.y||0,10),a.y?(a.id="HL_"+X,a.x1=9,a.y1=2,a.x2=5e3,a.y2=2,a.cursor="n-resize",a.w=6e3,a.h=4):(a.id="VL_"+X,a.x1=2,a.y1=9,a.x2=2,a.y2=6e3,a.cursor="e-resize",a.w=4,a.h=6e3),a.props.tree.push(Object(m.a)(a)),G[a.id]=Object(m.a)(a),a}return Object(l.a)(t,e),t}(u.a.Component),Q=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(i.a)(this,Object(o.a)(t).call(this,e))).render=function(e){var t=a.props.svg,s={};return Object.keys(a.props.attributes).forEach((function(e){e.startsWith("on")||(s[e]=a.props.attributes[e])})),s.style=Object(n.a)({},s.style),a.getEl(a.props._teg,s,t,a.props.text||null,a.props.children)},y()(Object(m.a)(a)),a._on=null,Object.keys(a.props.attributes).forEach((function(e){e.startsWith("on")&&(null===a._on&&(a._on={doc:a.props.doc}),a._on[e]=a.props.attributes[e])})),a}return Object(l.a)(t,e),Object(f.a)(t,[{key:"getEl",value:function(e,t,a,s,n){var r=0,i=this.props.doc;switch(e){case"svg":r=u.a.createElement("svg",Object.assign({},t,{ref:this.dom}),s,ee(a,n,i));break;case"line":r=u.a.createElement("line",t,s,ee(a,n,i));break;case"rect":r=u.a.createElement("rect",t,s,ee(a,n,i));break;case"polygon":r=u.a.createElement("polygon",t,s,ee(a,n,i));break;case"circle":r=u.a.createElement("circle",t,s,ee(a,n,i));break;case"path":r=u.a.createElement("path",t,s,ee(a,n,i));break;case"text":r=u.a.createElement("text",t,s,ee(a,n,i));break;case"defs":r=u.a.createElement("defs",t,s,ee(a,n,i));break;case"a":r=u.a.createElement("a",Object.assign({},t,E._on_(this._on)),s,ee(a,n,i));break;case"textPath":r=u.a.createElement("textPath",t,s,ee(a,n,i));break;case"ellipse":r=u.a.createElement("ellipse",t,s,ee(a,n,i));break;case"linearGradient":r=u.a.createElement("linearGradient",t,s,ee(a,n,i));break;case"stop":r=u.a.createElement("stop",t,s,ee(a,n,i));break;case"tspan":r=u.a.createElement("tspan",t,s,ee(a,n,i));break;case"g":r=u.a.createElement("g",t,s,ee(a,n,i));break;default:console.log("\u041d\u0435\u043e\u043f\u0438\u0441\u0430\u043d\u043d\u044b\u0439 SVG \u044d\u043b\u0435\u043c\u0435\u043d\u0442:",this.props._teg)}return r}}]),t}(u.a.Component),ee=function(e,t,a){if(!t)return null;var s=[];return t.forEach((function(t,r){var i=Math.random();switch(t._teg){case"svgBox":s.push(u.a.createElement(Z,Object.assign({doc:e.props.doc,key:i,tree:e.tree,id:"box",svg:e},t.attributes,{children:t.children,_teg:t._teg,setting:t.setting})));break;case"svgLine":var o="HL"===t.attributes.id?function(t){return e.hLine=t}:function(t){return e.vLine=t};s.push(u.a.createElement($,Object.assign({key:i,tree:e.tree,svg:e},t.attributes,{ref:o,_teg:t._teg})));break;case"#comment":break;default:s.push(u.a.createElement(Q,{key:r,doc:a,svg:e,attributes:Object(n.a)({},t.attributes),_teg:t._teg,text:t.text,children:t.children||null}))}})),s.length&&s},te=q,ae=["lbsd","lbse","lbmd","lbme","dt","tx"],se=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(i.a)(this,Object(o.a)(t).call(this,e))).setValue=function(e){return a.setState({value:e})},a.render=function(e){return a.state.value},a.state={value:a.props.xValue},a}return Object(l.a)(t,e),t}(u.a.Component),ne=function(e,t,a,s,r,i){var o=a.register,l=t.attributes?Object(n.a)({},t.attributes.style):Object(n.a)({},t.style),c=t.attributes?t.attributes.name:t.name;if(s=s||(t.attributes?t.attributes.readOnly:t.readOnly)||j.readOnly(a,c),j.hide(a,c)&&(l.display="none"),l.width&&(l.maxWidth=l.maxWidth||l.width,l.minWidth=l.minWidth||l.width),t._teg){if("svg"===t._teg.toLowerCase())return u.a.createElement(Q,{key:e,doc:a,_teg:"svg",attributes:t.attributes,children:t.children});var d,p,h=t.attributes||{},f=h.className||"",m=j.splitText(t.text,h);switch(t.children&&(p=re(t.children,a,s,r||"none"===l.display,h.wl||i))&&p.length&&(d=p[0],l=Object(n.a)({},l,{},p[1]),f=(f+" "+(p[2]||"")).trim()),t._teg.toLowerCase()){case"div":return h.className&&h.className.startsWith("label")&&!l.width&&i&&(l.width=l.minWidth=l.maxWidth=i),u.a.createElement("div",{key:e,id:h.id,className:f,style:l},m,d);case"a":return u.a.createElement("a",{href:h.href,id:h.id,name:c,target:h.target,title:h.title,className:h.className,style:l,key:e},m,d);case"img":var v=u.a.createElement("img",{src:h.src,width:"100%",alt:"alt",title:h.title,className:h.className,style:l,key:"i"+e});return h.href?u.a.createElement("a",{href:h.href,key:e,target:h.target,title:h.title},v,t.text):h.cmd?u.a.createElement("div",{onClick:function(e){return j.runCmd(a,h.cmd,h.param)},key:e,title:h.title,style:{cursor:"pointer"}},v,t.text):v;case"button":if(t._div){var y="BTN_"+t._cmd.toUpperCase();return u.a.createElement(S,Object.assign({key:e,label:t.text,cmd:t._cmd,param:t._param,doc:a},h,{style:l,ref:function(e){e&&!o[y]&&(o[y]=e)}}))}return u.a.createElement("button",Object.assign({key:e},h,{onClick:function(e){return j.runCmd(a,t._cmd,t._param,e.ctrlKey)}}),t.text);case"ul":return p=m?m.split("\n").map((function(e,t){return u.a.createElement("li",{key:t},"it")})):null,u.a.createElement("ul",Object.assign({key:e},h),p);case"ol":return p=m?m.split("\n").map((function(e,t){return u.a.createElement("li",{key:t},"it")})):null,u.a.createElement("ol",Object.assign({key:e},h),p);case"input":return u.a.createElement("input",Object.assign({key:e},h));case"form":return u.a.createElement("form",Object.assign({key:e},h),m,d);case"textarea":return u.a.createElement("textarea",Object.assign({key:e},h),m);case"label":return u.a.createElement("label",Object.assign({key:e},h),m,d);case"b":return u.a.createElement("b",Object.assign({key:e},h),m,d);case"i":return u.a.createElement("i",Object.assign({key:e},h),m,d);case"p":return u.a.createElement("p",Object.assign({key:e},h),m,d);case"span":return u.a.createElement("span",Object.assign({key:e},h),m,d);case"br":return u.a.createElement("br",{key:e});default:console.log("undefined _teg:",t._teg)}return null}if(t.field){var b=t.field[0].toUpperCase(),g=a.fieldValues&&a.fieldValues[b]||"";if("string"!==typeof g)return;var w=Object(n.a)({},t,{key:e,doc:a,xName:b,xValue:g.replace(/\xa4/g,"\n"),readOnly:s&&!t.edit,type:t.field[1],ls:t.field[2]||null,ref:function(e){o[b]=e},style:l});return ae.includes(w.type)&&!w.readOnly&&(w.myRow=a.currRow),function(e){switch(e.type){case"chb3":return u.a.createElement(W,e);case"chb":return u.a.createElement(K,e);case"lbse":case"lbme":case"tx":return u.a.createElement(L,e);case"lbsd":case"lbmd":return u.a.createElement(T,e);case"dt":return e.readOnly?u.a.createElement(L,Object.assign({},e,{xValue:j.dtRus(e.xValue)})):u.a.createElement(P,e);case"fd_p":case"fd_ol":case"fd_ul":case"fd":return u.a.createElement(M,e);case"table":case"gr":return u.a.createElement(A,e);case"rtf":return u.a.createElement(_,e);case"json":return u.a.createElement(J,e);case"list":return u.a.createElement(B,e);case"readyList":return u.a.createElement(z,e);case"view":return u.a.createElement(H,e);case"svg":return u.a.createElement(te,e);case"sch":return u.a.createElement(R,e);default:return console.warn("\u041d\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043d\u044b\u0439 \u0442\u0438\u043f \u043f\u043e\u043b\u044f",e.xName,e.type),u.a.createElement(L,e)}}(w)}if(t.fileShow){var k=Object(n.a)({},t,{style:l,readOnly:s&&!t.edit});return u.a.createElement(D,Object.assign({key:e,doc:a},k,{uploadDone:a.cmdSave2,ref:function(e){return a.fileShow[t.fileShow]=e}}))}if(t.rtf){var O=F(t.rtf,a,s,i);return O?u.a.createElement("div",{className:t.className,style:l,key:e},O):null}if(t.video){var E={};for(var x in t)"video"!==x&&(E[x]=t[x]);return u.a.createElement("video",Object.assign({key:e},E,{ref:function(e){return a.register[t.video]=e}}))}if(t.iframe){c=(c||"iframe").toUpperCase();var N=Object(n.a)({},t,{style:l,name:c});return u.a.createElement(C,Object.assign({key:e},N,{src:t.iframe.trim(),ref:function(e){return a.register[c]=e}}))}return"string"===typeof t.div?u.a.createElement("div",{key:e,style:Object(n.a)({},t.style),className:t.className},t.div):(console.log("empty element: ",t),null)},re=function(e,t,a,s,n,r){if(!e)return[];var i,o={},l="",c=e.map((function(e,c){if(!e||"object"!==typeof e)return null;if(e.rowStyle||e.rowClassName)return o=e.rowStyle||o,l=e.rowClassName||l,null;if(e.dumb)return u.a.createElement(se,{key:c,xValue:e.xValue,ref:function(a){return t.dumb[e.dumb]=a}});var d=e.attributes?e.attributes.name:e.name;return a||e.readOnly||j.readOnly(t,d)||!i&&e.field&&ae.includes(e.field[1])&&(i=e.field[0]),ne(r||c,e,t,a,s,n)}));return i&&!s&&(t.focusRows[t.currRow++]=i),[c.filter((function(e){return e})),o,l]},ie=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(i.a)(this,Object(o.a)(t).call(this,e))).state={isOpen:!1,sel:0},a.clearState={dlgDivStyle:{width:"600px",height:"400px"},sel:0},a.box=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Sova.online",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:["OK+|Y"],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return new Promise((function(r,i){return a.show(t,e,{buttons:s,cmCancel:i,cmButton:r,dlgDataStyle:n})}))},a.error=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"\u041e\u0448\u0438\u0431\u043a\u0430";return Object(m.a)(a)&&!a.state.isOpen?a.show(t,e,{type:"Error"}):alert(t+": "+e)},a.list=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0;return new Promise((function(r,i){return a.show(t,e,{lb:!0,multi:s.multi||!1,checked:s.checked||null,text:s.text||null,sep:s.sep||"|",buttons:["\u041e\u041a (Enter)+|1","\u041e\u0442\u043c\u0435\u043d\u0430 (Esc)"],cmCancel:i,cmButton:r,dlgDivStyle:n?{width:440,height:300,backgroundImage:"url(/image?24x24LB.png)"}:{width:740,height:500,backgroundImage:"url(/image?24x24LB.png)"},dlgDataStyle:n?{width:310,height:220}:null})}))},y()(Object(m.a)(a)),a.input=null,a}return Object(l.a)(t,e),Object(f.a)(t,[{key:"show",value:function(e,t,a){var s=this;if(this.state.isOpen)console.log("MsgBox.state.isOpen");else{var r=e.split("|"),i=Object(h.a)(r,2);this.title=i[0],this.header=i[1],this.cmCancel=a.cmCancel,this.cmButton=a.cmButton,this.lb=a.lb,this.multi=a.multi,this.checked=a.checked||[],this.result="",this.lb?(this.sep=a.sep||"|",this.text=a.text,this.mainSel=-1,this.items=[],t.forEach((function(e,t){var a=j.partition(e,s.sep),n=Object(h.a)(a,2),r=n[0],i=n[1];s.items[t]={ref:null,label:r,opt:i}})),this.setFilter(this.text)):this.items=t.split("\n"),this.focusBt=null,this.buttons=(a.buttons||["OK+|1"]).map((function(e,t){var a=e.indexOf("+")>=0,n=e.replace(/\+/g,"").split("|");return a&&(s.result=n[1]||""),u.a.createElement("button",{key:t,tabIndex:"1",style:{width:"105px",marginBottom:"10px"},onClick:function(){return s.btnClick(n[1])},onFocus:function(e){return s.result=n[1]||""},onBlur:function(e){return s.result=""},ref:function(e){a&&(s.focusBt=e)}},n[0])})),this.setState(Object(n.a)({},this.clearState,{dlgDivStyle:a.dlgDivStyle,dlgDataStyle:a.dlgDataStyle,isOpen:!0,sel:this.checked[0]||0})),setTimeout((function(e){s.lb&&s.input&&(s.items[s.state.sel]&&s.items[s.state.sel].ref&&s.items[s.state.sel].ref.div.focus(),s.input.focus())}),50)}}},{key:"componentDidUpdate",value:function(e,t){var a=this;this.input&&this.text&&(this.input.value=this.text),this.lb?setTimeout((function(e){return a.input&&a.input.focus()}),50):this.focusBt&&this.focusBt.focus()}},{key:"btnClick",value:function(e){var t=this;if(this.setState({isOpen:!1}),e&&this.cmButton)if(this.lb)if(this.items.length)if(this.multi){var a=this.checked.filter((function(e){return void 0!==e}));a=a.map((function(e){return t.items[e].label+(t.items[e].opt?t.sep+t.items[e].opt:"")})),this.cmButton(a.join("\n"))}else{var s=this.items[this.mainSel].opt?this.sep+this.items[this.mainSel].opt:"";this.cmButton(this.items[this.mainSel].label+s)}else this.cmButton("");else this.cmButton(e);else!e&&this.cmCancel&&this.cmCancel();this.lb=this.checked=this.filtered=this.items=null}},{key:"onkeydown",value:function(e){var t=this;if(!e.ctrlKey){if(13===e.keyCode||27===e.keyCode)return this.btnClick(13===e.keyCode?this.result||this.lb:null),e.stopPropagation(),void e.preventDefault();if(this.lb){var a=0;switch(e.keyCode){case 32:return this.toggle(this.mainSel,e);case 38:this.state.sel&&(a=this.state.sel-1);break;case 40:a=Math.min(this.last,this.state.sel+1);break;case 33:a=Math.max(0,this.state.sel-10);break;case 34:a=Math.min(this.last,this.state.sel+10);break;case 36:if(e.ctrlKey)break;return;case 35:if(e.ctrlKey){a=this.last;break}return;case 9:a=this.state.sel;break;default:if(!e.ctrlKey&&!e.altKey)return}e.stopPropagation(),e.preventDefault();var s=this.filtered&&this.filtered[a]?this.filtered[a].ref.props.index:a;this.items[s]&&this.items[s].ref&&this.items[s].ref.div.focus(),this.setState({sel:a}),setTimeout((function(e){return t.input&&t.input.focus()}),50)}}}},{key:"onchange",value:function(e){this.text=e.target.value,this.setFilter(this.text),this.setState({sel:0})}},{key:"setFilter",value:function(e){if(this.filtered=null,e){var t=e.toLowerCase();this.filtered=this.items.filter((function(e){var a=!0,s=!1,n=void 0;try{for(var r,i=" (\xab\"'-"[Symbol.iterator]();!(a=(r=i.next()).done);a=!0){var o=r.value;if((o+e.label).toLowerCase().includes(o+t))return!0}}catch(l){s=!0,n=l}finally{try{a||null==i.return||i.return()}finally{if(s)throw n}}return!1}))}}},{key:"onclick",value:function(e){var t=this;this.setState({sel:e}),setTimeout((function(e){return t.input&&t.input.focus()}),50)}},{key:"toggle",value:function(e,t){var a=this;if(this.multi){this.filtered=null,this.input.value="",this.text="";var s=this.checked.indexOf(e);s>=0?delete this.checked[s]:this.checked.push(e),this.setState({sel:e}),setTimeout((function(t){return a.items[e]&&a.items[e].ref&&a.items[e].ref.div.focus()}),100),setTimeout((function(e){return a.input&&a.input.focus()}),150)}t.stopPropagation(),t.preventDefault()}},{key:"render",value:function(){var e=this;if(!this.state.isOpen)return null;this.last=-1,this.mainSel=1;var t=this.items.map((function(t,a){return e.lb?e.filtered&&e.filtered.indexOf(e.items[a])<0?null:(e.last+=1,e.state.sel===e.last&&(e.mainSel=a),u.a.createElement(V,{key:a,index:a,iShow:e.last,items:e.items,multi:e.multi,onclick:e.onclick,ondoubleclick:e.btnClick,toggle:e.toggle,sel:e.state.sel===e.last,ref:function(t){e.items&&(e.items[a].ref=t)},check:e.checked.includes(a)})):u.a.createElement("div",{key:a},t||"\xa0")})),a=this.lb?u.a.createElement("div",{style:{padding:4,color:"#004080",font:"bold 9pt Arial"}},"\u041f\u043e\u0438\u0441\u043a",u.a.createElement("br",null),u.a.createElement("input",{className:"dlgInput",ref:function(t){return e.input=t},onKeyDown:this.onkeydown,onChange:this.onchange})):null;return u.a.createElement("div",{className:"dlgBG"},u.a.createElement("div",{className:"dlgDiv",style:this.state.dlgDivStyle,onKeyDown:this.onkeydown,tabIndex:"1"},u.a.createElement("div",{className:"dlgTitleBar"},this.title,u.a.createElement("div",{className:"dlgCloseButton",title:"\u0417\u0430\u043a\u0440\u044b\u0442\u044c",onClick:this.btnClick},"\xd7")),u.a.createElement("div",{style:{display:"block",width:"100%"}},u.a.createElement("div",{className:this.lb?"dlgList":"dlgData",style:Object(n.a)({},this.state.dlgDataStyle,{display:"inline-block"})},this.header?u.a.createElement("b",null,this.header,u.a.createElement("br",null),"\xa0",u.a.createElement("br",null)):null,t),u.a.createElement("div",{className:"dlgButtons"},u.a.createElement("br",null),this.buttons)),a))}}]),t}(u.a.Component),oe=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(i.a)(this,Object(o.a)(t).call(this,e))).state={isOpen:!1},a.getField=function(e,t){return j.getField(Object(m.a)(a),e,t)},a.setField=function(e,t){return j.setField(Object(m.a)(a),e,t)},a.setFocus=function(e){return j.setFocus(Object(m.a)(a),e)},a.changeDropList=function(e,t){var s=e.toUpperCase();a.register[s]&&a.register[s].changeDropList&&a.register[s].changeDropList(t)},a.inputBox=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"\u0412\u0432\u043e\u0434 \u0442\u0435\u043a\u0441\u0442\u0430";if(!a.state.isOpen)return new Promise((function(n,r){a.show(s,{D_TEXT:t},{style:{width:500,height:230},buttons:["\u0412\u0432\u043e\u0434+|Y","\u041e\u0442\u043c\u0435\u043d\u0430"],cmButton:function(e){return n(a.getField("d_text"))},cmCancel:r},{width:370,maxHeight:200},[[{rowStyle:{width:"auto"}},j.label(e,0,{textAlign:"left",padding:"30px 0 10px 5px"})],[{rowStyle:{width:"95%"}},{field:["D_TEXT","tx"]}]],"D_TEXT")}))},a.showFields=function(e){if(!a.state.isOpen){var t=JSON.parse("{"+e.slice(0,-1)+"}"),s=Object.keys(t).sort().map((function(e,a){return u.a.createElement("div",{style:{padding:"5px 4px"},key:a},u.a.createElement("div",{style:{fontWeight:"bold",color:"blue"}},e),u.a.createElement("div",null,(t[e][0]||"").replace(/\n/g,"\\n")||"<empty>"),u.a.createElement("b",null,u.a.createElement("div",null,(t[e][1]||"").replace(/\n/g,"\\n")||"<empty>")))})),n=u.a.createElement("div",{style:{background:"#f8f8f8",font:"normal 13px Courier",wordWrap:"break-word"}},s);return new Promise((function(e,t){return a.show("\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u043d\u044b\u0445 \u043f\u043e\u043b\u0435\u0439",n,{style:{width:800,height:500},buttons:["\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c+|Y","\u041d\u0435\u0442|N","\u041e\u0442\u043c\u0435\u043d\u0430"],cmButton:e,cmCancel:t},{width:670,maxHeight:470,overflow:"auto"})}))}},a.docPreview=function(e,t){a.main=t.props.main||t;var s=j.partition(e,"&"),n=Object(h.a)(s,2),r=n[0],i=n[1];if(a.state.isOpen)return alert("\u041d\u0435\u043b\u044c\u0437\u044f \u043e\u0442\u043a\u0440\u044b\u0442\u044c 2 \u0434\u0438\u0430\u043b\u043e\u0433\u043e\u0432\u044b\u0445 \u043e\u043a\u043d\u0430 \u043e\u0434\u043d\u043e\u0432\u0440\u0435\u043c\u0435\u043d\u043d\u043e");var o=Math.min(a.main.width,1120)-10,l=Math.min(a.main.height,690)-10;a.parent=t;var c=t&&t.props.layer||0,d={style:{width:o,height:l},buttons:["\u0417\u0430\u043a\u0440\u044b\u0442\u044c+","\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c|e"],cmCancel:function(){},cmButton:function(){return j.xopen("docopen?"+[r,i,"edit"].join("&"))}},p={width:o-130,maxHeight:l-30,overflow:"auto"};a.offset={padding:"".concat(40*c,"px 0 0 ").concat(40*c,"px")};var f=u.a.createElement(pe,{key:i,dbAlias:r,unid:i,rsMode:"preview",preview:!0,layer:c+1,main:a.main});a.show("\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430",f,d,p)},y()(Object(m.a)(a)),a.offset=null,a}return Object(l.a)(t,e),Object(f.a)(t,[{key:"show",value:function(e,t,a,s,r,i,o,l,c){var d=this;if(this.state.isOpen)console.log("DialogBox.state.isOpen");else{if(this.flist=null,this.dlgButtons=c,r)this.flist=r,this.setFocused=i,this.register={},this.hideNewValues={},this.dumb={},this.focusRows=[],this.currRow=0,this.msg=this.props.doc.msg,this.sova=this.props.doc.sova.dialog||{},this.sova.init&&this.sova.init(this),this.btnEnter=o,this.cmButton=a.cmButton,this.fieldValues={},t&&Object.keys(t).forEach((function(e){return d.fieldValues[e.toUpperCase()]=t[e]}));else if("string"===typeof t){var p={margin:"6px 0 0 6px",width:s.width-8,height:(s.heigh||s.maxHeight)-8,border:0,background:"#fff"};this.data=u.a.createElement(C,{src:t,title:t,style:p,load:function(e){d.iframe=e.refs.iframe}}),this.cmButton=function(e){return a.cmButton(e,d.iframe)}}else this.data=t,this.cmButton=a.cmButton;var h;if(this.title=e,this.cmCancel=a.cmCancel,this.result="",this.focusBt=null,a.buttons){h=(a.buttons||["OK+|1"]).map((function(e,t){var a=e.indexOf("+")>=0,s=e.replace(/\+/g,"").split("|");return a&&(d.result=s[1]||""),u.a.createElement("button",{key:t,tabIndex:(t+100).toString(),onClick:function(e){return d.btnClick(s[1]||"")},onFocus:function(e){return d.result=s[1]||""},onBlur:function(e){return d.result=""},ref:function(e){a&&(d.focusBt=e)}},s[0])}));var f=null;l&&(f=u.a.createElement("div",{key:Math.random()},re(l,this)[0])),this.buttons=u.a.createElement("div",{className:l?"moreButtons":this.dlgButtons||"dlgButtons"},h,f)}else this.buttons=null;this.setState({dlgDivStyle:Object(n.a)({},a.style),isOpen:!0,dlgDataStyle:Object(n.a)({},s)})}}},{key:"componentDidUpdate",value:function(e,t){this.setFocused?this.register[this.setFocused].setFocus():this.focusBt&&this.focusBt.focus()}},{key:"btnClick",value:function(e){this.setFocused=null,this.setState({isOpen:!1}),this.parent&&this.parent.setFocus(this.parent.focus),e&&this.cmButton?this.cmButton(e):!e&&this.cmCancel&&this.cmCancel()}},{key:"onkeydown",value:function(e){switch(e.keyCode){case 27:this.btnClick(null);break;case 13:if(e.shiftKey)return;this.btnEnter&&this.btnEnter in this.register?(e.preventDefault(),this.register[this.btnEnter].props.btnClick()):this.btnClick(this.result||1);break;default:if(!e.ctrlKey&&!e.altKey)return}e.stopPropagation()}},{key:"render",value:function(){var e=this;if(!this.state.isOpen)return null;if(this.flist){var t=this.flist.map((function(t,a){var s=re(t,e);return u.a.createElement("div",{className:s[2]||"row",key:a,style:Object(n.a)({},s[1])},s[0])}));this.data=u.a.createElement("div",null,t)}return u.a.createElement("div",{className:"dlgBG",style:this.offset?{position:"fixed",zIndex:500+this.layer}:{zIndex:500}},u.a.createElement("div",{onFocus:function(t){return e.btnClick("")},tabIndex:"1"},u.a.createElement("div",{style:this.offset,onFocus:function(t){return e.btnClick("")},tabIndex:"1"},u.a.createElement("div",{className:"dlgDiv",style:this.state.dlgDivStyle,onKeyDown:this.onkeydown,tabIndex:"1",onFocus:function(e){return e.stopPropagation()}},u.a.createElement("div",{className:"dlgTitleBar"},this.title,u.a.createElement("div",{className:"dlgCloseButton",title:"\u0417\u0430\u043a\u0440\u044b\u0442\u044c",onClick:function(t){return e.btnClick("")}},"\xd7")),u.a.createElement("div",{style:{display:"block",width:"100%",overflow:"hidden"}},u.a.createElement("div",{style:Object(n.a)({},this.state.dlgDataStyle,{display:"inline-block"})},this.data),this.buttons)))))}}]),t}(u.a.Component),le=function(e,t,a){return new Promise((function(s,n){var r="search4corr?"+[e.dbAlias,de(t).trim(),a.trim()].join("&");fetch("/action",{method:"post",body:r,credentials:"include"}).then((function(e){return e.json()})).then((function(t){var a=t.map((function(t,a){return ce(e,t,a)}));a.length>1||a[0]?s(u.a.createElement("div",{style:{overflow:"hidden"}},u.a.createElement("div",{style:{height:"80vh",overflow:"auto"}},u.a.createElement("table",{className:"sbcTable"},u.a.createElement("colgroup",null,u.a.createElement("col",{style:{width:"14%"}}),u.a.createElement("col",{style:{width:"20%"}}),u.a.createElement("col",{style:{width:"9%"}}),u.a.createElement("col",{style:{width:"33%"}}),u.a.createElement("col",{style:{width:"9%"}}),u.a.createElement("col",{style:{width:"15%"}})),a)))):s("\u041d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e")})).catch((function(e){return n(e.message)}))}))},ce=function(e,t,a){if(t[3]===e.unid)return u.a.createElement("tbody",{key:a},u.a.createElement("tr",null,u.a.createElement("td",{colSpan:"6"})));var s;try{s=JSON.parse(t[2].replace(/\xa4/g,"; ").replace(/\n/g,"; "))}catch(o){return u.a.createElement("div",null,"\u041e\u0448\u0438\u0431\u043a\u0430 JSON.parse",u.a.createElement("div",null,o),u.a.createElement("div",null,t[2]))}var n="".concat(t[4],"&").concat(t[3]),r=[0,1,2,3,4,5,6].map((function(t,a){switch(a){case 0:return u.a.createElement("td",{key:a},j.dtRus(s[0]),u.a.createElement("div",{className:"openButton",title:"\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430",onClick:function(t){return e.dlgPreview.docPreview(n,e)}},s.slice(1,4).join("").replace(/-/gi,"\u2011")||"\u0431\u0435\u0437 \u043d\u043e\u043c\u0435\u0440\u0430"),s[10]);case 1:return u.a.createElement("td",{key:a},u.a.createElement("b",null,s[9]),u.a.createElement("br",null),s[4]);case 2:return u.a.createElement("td",{key:a},u.a.createElement("div",{className:"openButton",title:"\u041d\u043e\u0432\u043e\u0435 \u043e\u0431\u0440\u0430\u0449\u0435\u043d\u0438\u0435 (\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0440\u0435\u043a\u0432\u0438\u0437\u0438\u0442\u044b \u0437\u0430\u044f\u0432\u0438\u0442\u0435\u043b\u044f)",onClick:function(t){return ue(e,t,n+"&\u0437\u0430\u044f\u0432\u0438\u0442\u0435\u043b\u044c")}},"\u041d\u043e\u0432\u043e\u0435"),u.a.createElement("div",{className:"openButton",title:"\u041f\u043e\u0432\u0442\u043e\u0440\u043d\u043e\u0435 \u043e\u0431\u0440\u0430\u0449\u0435\u043d\u0438\u0435 (\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0440\u0435\u043a\u0432\u0438\u0437\u0438\u0442\u044b, \u0441\u0432\u044f\u0437\u0430\u0442\u044c \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u044b)",onClick:function(t){return ue(e,t,n+"&")}},"\u043f\u043e\u0432\u0442\u043e\u0440\u043d\u043e\u0435"));case 3:return u.a.createElement("td",{key:a},s[5]);case 4:return u.a.createElement("td",{key:a},u.a.createElement("div",{className:"openButton",title:"\u0421\u0432\u044f\u0437\u0430\u0442\u044c \u0441 \u0442\u0435\u043a\u0443\u0449\u0438\u043c \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u043e\u043c",onClick:function(t){return ue(e,t,n+"&\u0441\u0432\u044f\u0437\u0430\u0442\u044c")}},"\u0441\u0432\u044f\u0437\u0430\u0442\u044c"),u.a.createElement("div",{className:"openButton",title:"\u041e\u0431\u044a\u0435\u0434\u0438\u043d\u0438\u0442\u044c \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442 \u043a\u0430\u043a \u0434\u0443\u0431\u043b\u0438\u043a\u0430\u0442",onClick:function(t){return ue(e,t,n+"&\u0434\u0443\u0431\u043b\u0438\u043a\u0430\u0442")}},"\u0434\u0443\u0431\u043b\u0438\u043a\u0430\u0442"));case 5:return u.a.createElement("td",{key:a},s[6])}return null})),i=s[7]||s[8]?u.a.createElement("tr",null,u.a.createElement("td",{colSpan:"6",key:7,style:{color:"#048",textAlign:"left",border:"0 solid #bdf",borderTopWidth:1}},u.a.createElement("b",null,u.a.createElement("span",null,s[7].split(" ")[0]+": ")),u.a.createElement("span",null,s[8]))):null;return u.a.createElement("tbody",{key:a,style:{background:a%2?"#fff":"#def"}},u.a.createElement("tr",null,r),i)},ue=function(e,t,a){t.stopPropagation();var s="fillFields?"+e.dbAlias+"&"+a+"&";fetch("/action",{method:"post",body:s,credentials:"include"}).then((function(e){return e.json()})).then((function(t){for(var a in t)"--"===t[a]?e.setField(a,""):"GROUNDS"===a&&e.getField("GROUNDS")?function(){var s=e.getField("GROUNDS").split("\n");t[a].replace(/\xa4/g,"\n").split("\n").forEach((function(e){s.includes(e)||s.push(e)})),e.setField("GROUNDS",s.join("\n"))}():e.setField(a,t[a]);"rkckg"===e.getField("form").toLowerCase()&&window.rnnGroup&&setTimeout((function(e){return window.rnnGroup(void 0,!0)}),10),e.dlg.btnClick()})).catch((function(t){e.dlg.btnClick(),e.msg.error(t)}))},de=function(e){var t=e.toLowerCase(),a=e.replace(/\u0438 \u0434\u0440$/gi,"").replace(/\+/gi,"").replace(/;/gi,",").trim();if(["\u0438 \u0434\u0440.","\u0438 \u0434\u0440\u0443\u0433\u0438\u0435","(","\u0432 \u0438\u043d\u0442\u0435\u0440\u0435\u0441\u0430\u0445","\u0432 \u043e\u0442\u043d\u043e\u0448\u0435\u043d\u0438\u0438",","].forEach((function(e){var t=a.toLowerCase().indexOf(e);t>=0&&(a=a.substr(0,t).trim())})),t.includes("\u0431\u0435\u0437 \u043f\u043e\u0434\u043f\u0438\u0441\u0438")||t.includes("\u0436\u0438\u0442\u0435\u043b\u0438 ")||t.includes("\u0433\u0440\u0443\u043f\u043f\u0430 ")||t.includes("\u043a\u043e\u043b\u043b\u0435\u043a\u0442\u0438\u0432 "))return a;var s=a.split(" ");return 3===s.length?"".concat(s[0]," ").concat(s[1].charAt(0),".").concat(s[2].charAt(0),"."):a},pe=(a(18),a(19),a(20),a(21),a(22),function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(i.a)(this,Object(o.a)(t).call(this,e))).cmdList={edit:function(e){return a.cmdEdit()},save:function(e){return a.cmdSave()},close:function(e){return a.cmdClose()},saveClose:function(e){return a.cmdSave(!0)},prn:function(e){return a.cmdSave(null,!0)},docOpen:function(e){return j.xopen("docopen?"+e)},dbOpen:function(e){return j.xopen("dbopen?"+e)},xopen:function(e){return j.xopen(e)},newDoc:function(e){var t=e.split("&"),a=Object(h.a)(t,3),s=a[0],n=a[1];a[2]?j.xopen("newdoc?"+s+"&"+n):window.open("newdoc?"+s+"&"+n)},docPreView:function(e){return a.dlgPreview.docPreview(e,Object(m.a)(a))},addNo:function(e){return function(e){var t=e.getField("ADDNO").split("\n"),a=e.getField("ADDDA").split("\n"),s="";t.forEach((function(e,t){s+=e.trim()?e+" "+j.dtRus(a[t])+"\n":""})),e.dlg.inputBox("\u0412\u0432\u0435\u0434\u0438\u0442\u0435: \u043d\u043e\u043c\u0435\u0440-\u043f\u0440\u043e\u0431\u0435\u043b-\u0434\u0430\u0442\u0430 (\u041f-125 17,07,2018)",s,"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0434\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u043d\u043e\u043c\u0435\u0440").then((function(t){var a="",s="";t.replace(/,/g,".").split("\n").forEach((function(e){for(var t=e.trim();t.includes("  ");)t=t.replace(/ {2}/g," ");if(t){var n=j.partition(t," ");a+=n[0]+"\n",s+=n[1]+"\n"}})),e.setField("ADDNO",a?a.slice(0,-1):""),e.setField("ADDDA",s?s.slice(0,-1):"")})).catch((function(e){}))}(Object(m.a)(a))},searchByCorr:function(e){var t;(t=Object(m.a)(a)).dlg.state.isOpen?console.log("searchByCorr: doc.dlg.state.isOpen"):(t.dlg.show("\u041f\u043e\u0438\u0441\u043a \u043f\u043e \u0437\u0430\u044f\u0432\u0438\u0442\u0435\u043b\u044e \u0438 \u0440\u0430\u0439\u043e\u043d\u0443",{SBC_TEXT1:t.getField("fromCorr")||t.getField("toCorr"),SBC_TEXT2:t.getField("rnn")},{style:{width:"90vw",minWidth:"600px",top:"5%",height:"90vh",minHeight:"420px"},cmCancel:function(e){return t.setFocus(t.focus)}},{width:"100%",height:"86vh",overflow:"hidden"},[[{rowStyle:{width:"auto",padding:"5px 0",margin:"5px auto 5px",background:"#eee",border:"0 solid #aaa",borderWidth:"0 2px 2px 0"}},j.label("\u0417\u0430\u044f\u0432\u0438\u0442\u0435\u043b\u044c",0,{paddingLeft:20}),{field:["SBC_TEXT1","tx"],style:{width:"60mm"}},j.label("\u0420\u0430\u0439\u043e\u043d",0,{paddingLeft:20}),{field:["SBC_TEXT2","tx"],style:{width:"60mm"}},j.label("","20px"),{_teg:"button",_div:1,text:"\u043f\u043e\u0438\u0441\u043a",_cmd:"SBC",attributes:{className:"svTop",style:{width:"17mm"},btnClick:function(e){t.dlg.dumb.sbc.setValue(u.a.createElement("div",{className:"spinner"})),t.dlg.forceUpdate(),le(t,t.dlg.getField("SBC_TEXT1"),t.dlg.getField("SBC_TEXT2")).then((function(e){t.dlg.dumb.sbc.setValue(e),t.dlg.forceUpdate()})).catch((function(e){return t.msg.error(e.message)}))}}},j.label("","20px")],[{dumb:"sbc",xValue:u.a.createElement("div",{className:"spinner"})}]],"SBC_TEXT1","BTN_SBC"),le(t,t.getField("fromCorr")||t.getField("toCorr"),t.getField("rnn")).then((function(e){t.dlg.dumb.sbc.setValue(e),t.dlg.forceUpdate()})).catch((function(e){return t.msg.error(e.message)})))},docSN:function(e){return function(e){var t="1"===e.getField("Main")?"0":"1";if(e.getField("docNo"))e.msg.box('\n\u041f\u043e\u043b\u0435 \u043d\u043e\u043c\u0435\u0440\u0430 \u0443\u0436\u0435 \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u043e.\n\n\u0414\u043b\u044f \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u043d\u043e\u043c\u0435\u0440\u0430 \u043d\u0430\u0436\u043c\u0438\u0442\u0435 "\u0412\u0432\u0435\u0441\u0442\u0438 \u2116".\n\n\n\u0414\u043b\u044f \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u0438\u0440\u043e\u0432\u043a\u0438 \u043f\u043e\u0440\u044f\u0434\u043a\u043e\u0432\u043e\u0433\u043e \u043d\u043e\u043c\u0435\u0440\u0430 \u043d\u0430\u0436\u043c\u0438\u0442\u0435\n\u043a\u043d\u043e\u043f\u043a\u0443 "\u041d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u2116"',"\u041f\u0420\u0418\u0421\u0412\u041e\u0418\u0422\u042c \u041f\u041e\u0420\u042f\u0414\u041a\u041e\u0412\u042b\u0419 \u041d\u041e\u041c\u0415\u0420",["\u041e\u041a+","\u0412\u0432\u0435\u0441\u0442\u0438 \u2116|O","\u041d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u2116|N","\u041e\u0442\u043c\u0435\u043d\u0430"]).then((function(a){if("O"===a)e.dlg.inputBox("\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043d\u043e\u0432\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u2116",e.getField("docNo"),"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043d\u043e\u043c\u0435\u0440").then((function(t){return e.setField("docNo",t)})).catch((function(t){return e.setFocus(e.focus)}));else if("N"===a){var s="sno?".concat(e.dbAlias,"&get").concat(t);fetch("/action",{method:"post",body:s,credentials:"include"}).then((function(e){return e.text()})).then((function(a){e.dlg.inputBox("\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043d\u043e\u043c\u0435\u0440 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u043e\u0433\u043e \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\n \u0438 \u043d\u0430\u0436\u043c\u0438\u0442\u0435 Enter",a,"\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0430 \u043f\u043e\u0440\u044f\u0434\u043a\u043e\u0432\u043e\u0433\u043e \u043d\u043e\u043c\u0435\u0440\u0430").then((function(a){a&&!isNaN(Number(a))?(s="sno?".concat(e.dbAlias,"&set").concat(t,"\xa4").concat(a),fetch("/action",{method:"post",body:s,credentials:"include"}).then((function(e){return e.text()})).then((function(t){return e.msg.box("\u0421\u043e\u0445\u0440\u0430\u043d\u0435\u043d \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0439 \u043d\u043e\u043c\u0435\u0440: "+t,"\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0430 \u043d\u043e\u043c\u0435\u0440\u0430")})).catch((function(t){return e.msg.error("\n"+s+"\n\n"+t.message,"\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0437\u0430\u043f\u0440\u043e\u0441\u0435 \u043d\u043e\u043c\u0435\u0440\u0430")}))):e.msg.box("\u041d\u0435\u0434\u043e\u043f\u0443\u0441\u0442\u0438\u043c\u044b\u0439 \u0441\u0438\u043c\u0432\u043e\u043b","\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0430 \u043d\u043e\u043c\u0435\u0440\u0430")})).catch((function(t){return e.setFocus(e.focus)}))})).catch((function(t){return e.msg.error(t.message,"\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0437\u0430\u043f\u0440\u043e\u0441\u0435 \u043d\u043e\u043c\u0435\u0440\u0430")}))}})).catch((function(t){return e.setFocus(e.focus)}));else{var a="sno?".concat(e.dbAlias,"&inc").concat(t);fetch("/action",{method:"post",body:a,credentials:"include"}).then((function(e){return e.text()})).then((function(a){if(a.endsWith("."))if(e.getField("Main")){var s=e.getField("grounds");e.setField("docNo",a+(s?s.split("\n").length+1:"1"))}else e.setField("docNo",a.slice(0,-1));else e.setField("docNo",a);"0"===t&&"rkckg"===e.getField("form").toLowerCase()&&window.rnnGroup&&window.rnnGroup(e,!0)})).catch((function(t){return e.msg.error(t.message,"\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0437\u0430\u043f\u0440\u043e\u0441\u0435 \u043d\u043e\u043c\u0435\u0440\u0430")}))}}(Object(m.a)(a))},docPreview:function(e){return a.dlgPreview.docPreview(e,Object(m.a)(a))}},a.dragStart=!1,a.setDocProps=function(e){a.fieldValues=Object(n.a)({},e.data),a.isNew=!e.data.MODIFIED,a.printList=e.printList,a.rsMode=e.rsMode,a.cssJsUrl=e.cssJsUrl},a.loadForm=function(e){a.waitLoad=!1,a.sova=window.sovaActions&&window.sovaActions[a.getField("form").toLowerCase()]||{},a.sova.init&&a.sova.init(Object(m.a)(a)),a.children=e.children,a.pageAttr=e.attributes||{},a.focus="edit"===a.rsMode&&a.pageAttr.focus||"BTN_CLOSE",a.className=a.pageAttr.className||"",a.style=Object(n.a)({},a.pageAttr.style,{},a.props.style),a.setState({spinner:!1,rsMode:a.rsMode,readOnly:a.pageAttr.readOnly||!["edit","admin"].includes(a.rsMode)}),!a.init2&&window.sovaActions&&window.sovaActions[a.getField("form").toLowerCase()]&&window.sovaActions[a.getField("form").toLowerCase()].init2&&(window.sovaActions[a.getField("form").toLowerCase()].init2(Object(m.a)(a)),a.init2=!0),a.setFocus(a.focus)},a.loadError=function(e){var t="dbAlias: "+a.dbAlias+"\nunid: "+a.unid+"\n\n"+e;a.msg?a.msg.error(t,"\u041e\u0448\u0438\u0431\u043a\u0430 \u043e\u0442\u043a\u0440\u044b\u0442\u0438\u044f \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430"):(a.errMsg=u.a.createElement("div",null,t.split("\n").map((function(e,t){return u.a.createElement("div",{key:t},e||"\xa0")}))),console.log("\u041e\u0448\u0438\u0431\u043a\u0430 \u043e\u0442\u043a\u0440\u044b\u0442\u0438\u044f \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430:"+t)),a.waitLoad=!1,a.setState({spinner:!1})},a.cmdClose=function(e){return!a.waitSave&&a.closeDoc(!1)},a.validate=function(e){return new Promise((function(e,t){var s=a.sova.validate;if(!s)return e();var n=function(e){if("form"!==e.toLowerCase()){var n=s[e](Object(m.a)(a));if(n||0===n)return a.msg.box(n||'\u041f\u043e\u043b\u0435 "'.concat(e,'" \u043d\u0435 \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u043e')).then((function(s){return t(a.setFocus(e))})).catch((function(e){return t()})),{v:void 0}}};for(var r in s){var i=n(r);if("object"===typeof i)return i.v}for(var o in s)if("form"===o.toLowerCase())return void s[o](Object(m.a)(a)).then((function(t){return e()})).catch((function(e){return t(a.setFocus(a.focus))}));return e()}))},a.getField=function(e,t){return j.getField(Object(m.a)(a),e,t)},a.setField=function(e,t,s){return j.setField(Object(m.a)(a),e,t,s)},a.setFocus=function(e){return j.setFocus(Object(m.a)(a),e)},y()(Object(m.a)(a)),a.util=j,a.tidy=!0,a.viewRefresh=!1,a.waitLoad=!0,a.waitSave=!1,a.toolbar=null,a.fileShow={},a.register={},a.dumb={},a.hideNewValues={},a.savedText="",a.dbAlias=a.props.dbAlias,a.unid=a.props.unid,a.rsMode=a.props.rsMode,a.cssJsUrl=a.props.cssJsUrl,a.loadDocUrl=function(e){return a.props.newForm?"api.get?newForm&".concat(a.dbAlias,"&").concat(a.props.newForm,"&").concat(a.rsMode):"api.get?loadDoc&".concat(a.dbAlias,"&").concat(a.unid,"&").concat(a.rsMode)},window.sovaPages||(a.mainDoc=!0,window.sovaPages={main:{doc:Object(m.a)(a)}}),a.state={spinner:!1},a}return Object(l.a)(t,e),Object(f.a)(t,[{key:"addPage",value:function(e){var t=e.page||"page";window.sovaPages[t]={},window.sovaPages[t].props=Object(n.a)({},e),this.forceUpdate()}},{key:"closePage",value:function(e){"main"!==e&&(window.sovaPages[e].doc=null,window.sovaPages[e]=null,delete window.sovaPages[e],this.forceUpdate())}},{key:"maxPage",value:function(e){var t=window.sovaPages[e].doc;j.xopen("docopen?"+t.dbAlias+"&"+t.unid+"&"+t.rsMode)}},{key:"dragPage",value:function(e){if(1===e.buttons&&this.dragStart&&this.x1){var t=window.sovaPages[this.dragStart].props.frameStyle;t.left+=e.screenX-this.x1,t.top+=e.screenY-this.y1,this.x1=e.screenX,this.y1=e.screenY,this.forceUpdate(),e.stopPropagation(),e.preventDefault()}}},{key:"pageMouseUp",value:function(e){if(this.dragStart){var t=window.sovaPages[this.dragStart].props.frameStyle;t.left+=e.screenX-this.x1,t.top+=e.screenY-this.y1,this.dragStart=!1,this.forceUpdate()}}},{key:"componentDidMount",value:function(){var e=this;setTimeout((function(){e.waitLoad&&e.setState({spinner:!0})}),500),this.props.fieldValues?(this.fieldValues=this.props.fieldValues,this.isNew=!this.fieldValues.MODIFIED,this.printList=this.props.printList,this.props.owlDebug?(console.log("debug: this.props.urlForm",this.props.urlForm),j.jsonByUrl(this.props.urlForm).then((function(t){return j.addJsCSS(e.cssJsUrl,(function(a){return e.loadForm(t)}))}))):j.jsonByUrl(this.props.urlForm).then((function(t){return j.addJsCSS(e.cssJsUrl,(function(a){return e.loadForm(t)}))})).catch((function(t){return e.loadError(t+"\n\ndoc.props.urlForm:"+e.props.urlForm)}))):this.props.owlDebug?(console.log("debug:this.loadDocUrl():",this.loadDocUrl()),j.jsonByUrl(this.loadDocUrl()).then((function(t){return e.setDocProps(t),t.urlForm?j.jsonByUrl(t.urlForm):null})).then((function(t){return j.addJsCSS(e.cssJsUrl,(function(a){return e.loadForm(t)}))}))):j.jsonByUrl(this.loadDocUrl()).then((function(t){return e.setDocProps(t),t.urlForm?j.jsonByUrl(t.urlForm):null})).then((function(t){return j.addJsCSS(e.cssJsUrl,(function(a){return e.loadForm(t)}))})).catch((function(t){return e.loadError(t+"\n\nurl: "+e.loadDocUrl)}))}},{key:"cmdEdit",value:function(){"readOnly"!==this.state.rsMode&&(window.location.href="docopen?"+this.dbAlias+"&"+this.unid+"&edit")}},{key:"cmdPrn",value:function(){var e=this;if(this.flagPrint){if(this.flagPrint=!1,this.fieldValues.FORM.endsWith(".print")||!this.printList)return window.print();var t=this.printList.replace(/\xa4/g,"\n").split("\n");if("o-"===this.fieldValues.FORM||2===t.length)return j.xopen("docopen?"+this.dbAlias+"&"+this.unid+"&read&"+t[1].split("|").slice(-1)[0]);this.msg.list(t.slice(1),"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0444\u043e\u0440\u043c\u0443 \u0434\u043b\u044f \u043f\u0435\u0447\u0430\u0442\u0438",{},!0).then((function(a){var s=a.indexOf("|")>=0?j.partition(a,"|")[1]:a;j.xopen("docopen?"+[e.dbAlias,a.startsWith("rk")?t[0]:e.unid,"read",s].join("&")),e.setFocus("BTN_CLOSE")})).catch((function(t){return e.setFocus("BTN_CLOSE")}))}}},{key:"cmdSave",value:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!this.waitSave){if(this.waitSave=!0,this.flagClose=e,this.flagPrint=a,this.state.readOnly||!this.getNewValues(!1)||this.getField("noSave"))return this.waitSave=!1,a?this.cmdPrn():e&&this.props.closeDoc(this,this.tidy);this.validate().then((function(e){for(var a in setTimeout((function(){t.waitSave&&t.setState({spinner:!0})}),500),t.fileShow)t.fileShow[a].startUpload();t.cmdSave2()})).catch((function(e){t.waitSave=!1}))}}},{key:"changeDropList",value:function(e,t){var a=e.toUpperCase();this.register[a]&&this.register[a].changeDropList&&this.register[a].changeDropList(t)}},{key:"getNewValues",value:function(e){var t=this;if(this.getField("noSave"))return"";var a="";for(var s in this.fileShow)a+=this.fileShow[s].getNewValues(e);return Object.keys(this.hideNewValues).forEach((function(e){e in t.fieldValues||(a+=j.addJson(e,"",t.hideNewValues[e]))})),Object.keys(this.fieldValues).forEach((function(e){if(!(e in t.register)){var s=t.isNew?"":t.fieldValues[e],n=e in t.hideNewValues?t.hideNewValues[e]:t.fieldValues[e];a+=j.addJson(e,s,n)}})),Object.keys(this.register).forEach((function(e){if("fd"!==t.register[e].props.type){var s=t.isNew?"":t.fieldValues[e]||"",n=t.register[e].getValue?t.register[e].getValue():t.fieldValues[e]||"";a+=j.addJson(e,s,n)}})),this.tidy=this.tidy&&!a,a&&(a.includes('"UNID":["')||(a+=j.addJson("UNID","",this.unid)),this.fieldValues.REF&&!a.includes('"REF":["')&&(a+=j.addJson("REF","",this.fieldValues.REF))),a}},{key:"cmdSave2",value:function(){for(var e in this.fileShow)if(this.fileShow[e].run)return;for(var t in this.fileShow)if(this.fileShow[t].uploadError)return this.waitSave=!1,void this.setState({spinner:!1});var a=this.getNewValues(!0);if(a)this.runXhrSave("{"+a.slice(0,-1)+"}");else{if(this.flagClose)return this.props.closeDoc(this,this.tidy);this.waitSave=!1,this.setState({spinner:!1}),this.cmdPrn()}}},{key:"handleKeyDown",value:function(e){if(!(this.waitSave||"preview"===this.rsMode||this.msg.state.isOpen||this.dlg.state.isOpen||this.dlgPreview.state.isOpen||this.getField("_page_")||"arm"===this.getField("form")&&"edit"!==this.rsMode)){switch(e.keyCode){case 49:if(e.altKey){this.docSN();break}return;case 83:if(!this.state.readOnly&&e.ctrlKey){this.cmdSave(!1);break}return;case 27:this.closeDoc(e.shiftKey);break;case 80:if(e.ctrlKey){this.cmdSave(null,!0);break}return;case 13:if(e.ctrlKey&&"edit"!==this.rsMode){this.cmdEdit();break}return;default:return}e.stopPropagation(),e.preventDefault()}}},{key:"closeDoc",value:function(e){var t=this;if(this.state.readOnly||!this.dbAlias)return this.props.closeDoc(this,!0);if(e)return this.cmdSave(!0);var a=this.getNewValues(!1);if(!a)return this.props.closeDoc(this,this.tidy);this.msg.box("\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f ?","\u0414\u043e\u043a\u0443\u043c\u0435\u043d\u0442 \u0431\u044b\u043b \u0438\u0437\u043c\u0435\u043d\u0435\u043d",["\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c+|Y","\u041d\u0435\u0442|N","\u0418\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f|S","\u041e\u0442\u043c\u0435\u043d\u0430"]).then((function(e){"Y"===e?t.cmdSave(!0):"N"===e?t.props.closeDoc(t,!0):"S"===e&&t.dlg.showFields(a).then((function(e){"Y"===e?t.cmdSave(!0):"N"===e&&t.props.closeDoc(t,!0)})).catch((function(e){return t.setFocus(t.focus)}))})).catch((function(e){return t.setFocus(t.focus)}))}},{key:"addFiles",value:function(e){if(!this.state.readOnly)for(var t in this.fileShow)if(!this.fileShow[t].props.readOnly){this.fileShow[t].addFiles(e);break}e.stopPropagation(),e.preventDefault()}},{key:"render",value:function(){var e=this;if(this.waitLoad)return this.state.spinner?b(!0,!1):null;if(!this.children)return u.a.createElement("div",null,u.a.createElement("h2",null,"\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u043e\u0442\u043a\u0440\u044b\u0442\u0438\u0438 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430"),u.a.createElement("h3",null,"\u041f\u0443\u0441\u0442\u0430\u044f \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0430: "+this.props.urlForm,u.a.createElement("br",null),this.errMsg,u.a.createElement("br",null),this.dbAlias+"&"+this.unid));this.focusRows=[],this.currRow=0;var a=re(this.children,this,this.state.readOnly,!1,this.pageAttr.wl),s=null;this.mainDoc&&(s=Object.keys(window.sovaPages).map((function(a,s){var r=window.sovaPages[a];return"main"!==a&&r?u.a.createElement("div",{className:"pageFrame",key:a+s,tabIndex:"1",style:Object(n.a)({},r.props.frameStyle,{zIndex:e.zIndex===a?999:s+10,backgroundColor:e.dragStart===a?"rgba(0,0,0, 0.2)":"#fff"})},u.a.createElement("div",{className:"dlgTitleBar",style:{cursor:"move"},onMouseDown:function(t){e.x1=t.screenX,e.y1=t.screenY,e.dragStart=e.zIndex=a}},r.props.title||"Multi-page",u.a.createElement("div",{className:"dlgCloseButton",title:"\u0417\u0430\u043a\u0440\u044b\u0442\u044c",onClick:function(t){return e.closePage(a)}},"\xd7"),u.a.createElement("div",{className:"dlgMaxButton",title:"\u041e\u0442\u043a\u0440\u044b\u0442\u044c \u0432 \u043d\u043e\u0432\u043e\u0439 \u0432\u043a\u043b\u0430\u0434\u043a\u0435",onClick:function(t){return e.maxPage(a)}},"\u25b2")),u.a.createElement("div",{style:{display:e.dragStart===a?"none":"block",width:"100%",position:"realtive"}},u.a.createElement(t,Object.assign({},r.props,{closeDoc:function(t){return e.closePage(a)},ref:function(e){return r.doc=e}})))):null})));var r=this.readOnly||!this.savedText?null:u.a.createElement("div",{className:"saved",style:{color:this.state.saved?"#fff":"#ddf"}},this.savedText);return u.a.createElement("div",{className:this.className,style:Object(n.a)({position:"relative"},this.style),tabIndex:"1",onKeyDown:this.handleKeyDown,onDragOver:function(e){e.stopPropagation(),e.preventDefault()},onDrop:function(e){e.stopPropagation(),e.preventDefault()},onMouseMove:this.dragPage,onMouseUp:this.pageMouseUp,ref:function(t){t&&(e.width=t.offsetWidth,e.height=t.offsetHeight)}},"edit"===this.rsMode?u.a.createElement("audio",{ref:function(t){return e.audiotuk=t},style:{display:"none"},src:"/image?tuk.wav"}):null,u.a.createElement(ie,{doc:this,ref:function(t){return e.msg=t}}),u.a.createElement(oe,{doc:this,ref:function(t){return e.dlg=t}}),u.a.createElement(oe,{doc:this,ref:function(t){return e.dlgPreview=t}}),this.waitSave&&this.state.spinner?b(!0,!1):null,r,u.a.createElement("div",{style:Object(n.a)({position:"relative"},a[1]),className:a[2],onDrop:this.addFiles},a[0]),s)}},{key:"runXhrSave",value:function(e,t){var a=this;this.viewRefresh=!0;var s="/saveDoc?"+this.dbAlias+"&"+(t||"");fetch(s,{method:"post",body:e,credentials:"include"}).then((function(t){a.waitSave=!1,409===t.status?(a.setState({spinner:!1}),t.text().then((function(t){return a.msg.box("\u041f\u0415\u0420\u0415\u0417\u0410\u041f\u0418\u0421\u0410\u0422\u042c \u0414\u041e\u041a\u0423\u041c\u0415\u041d\u0422?\n"+t,"\u041a\u043e\u043d\u0444\u043b\u0438\u043a\u0442 \u043f\u0440\u0438 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0438",["\u0414\u0430+|Y","\u041d\u0435\u0442"]).then((function(t){a.waitSave=!0,setTimeout((function(){a.waitSave&&a.setState({spinner:!0})}),500),a.runXhrSave(e,"force")})).catch((function(e){a.flagClose=!1}))})).catch((function(e){return alert("\u041a\u043e\u043d\u0444\u043b\u0438\u043a\u0442 \u043f\u0440\u0438 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0438")}))):449===t.status?(a.setState({spinner:!1}),t.text().then((function(t){return a.msg.box(t+"\n\n\u0421\u041e\u0425\u0420\u0410\u041d\u0418\u0422\u042c?","\u041f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0439 \u043f\u0440\u0438 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0438",["\u0414\u0430+|Y","\u041d\u0435\u0442"]).then((function(t){a.waitSave=!0,setTimeout((function(){a.waitSave&&a.setState({spinner:!0})}),500),a.runXhrSave(e,"force")})).catch((function(e){a.flagClose=!1}))})).catch((function(e){return alert("\u041f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0439")}))):200!==t.status?(a.flagClose=!1,a.setState({spinner:!1}),a.msg.error("DocSave-status ".concat(t.status,"\n").concat(t.statusText,"\n\n").concat(s))):a.flagClose?(a.waitSave=!1,a.setState({spinner:!1}),setTimeout((function(e){return a.props.closeDoc(a,!1)}),100)):j.jsonByUrl(a.loadDocUrl()).then((function(e){for(var t in a.setDocProps(e),a.fileShow)a.fileShow[t].initialize();Object.keys(a.fieldValues).forEach((function(e){e in a.register&&a.register[e].setValue&&a.register[e].setValue(a.fieldValues[e].replace(/\xa4/g,"\n"))})),a.hideNewValues={},a.savedText="Saved "+j.partition(j.formatDateTime(new Date)," ")[1],a.setState({spinner:!1,saved:!0}),setTimeout((function(e){return a.setState({saved:!1})}),2e3),a.cmdPrn(),j.runCmd(a,"saved")})).catch((function(e){a.waitSave=!1,a.setState({spinner:!1}),a.msg.error("DocSave-reload-error:"+e.message+"\n\nurl:"+s)}))})).catch((function(e){a.flagClose=!1,a.waitSave=!1,a.setState({spinner:!1}),a.msg.error("DocSave-error:"+(e.message||e)+"\n\nurl:"+s)}))}}]),t}(u.a.Component)),he=function(e){function t(){var e,a;Object(r.a)(this,t);for(var s=arguments.length,l=new Array(s),c=0;c<s;c++)l[c]=arguments[c];return(a=Object(i.a)(this,(e=Object(o.a)(t)).call.apply(e,[this].concat(l)))).closeDoc=function(e,t){var a=e.getField("autoOrder");if(!a||t){if(e.viewRefresh){var s=window.opener&&!window.opener.closed&&window.opener.top&&!window.opener.top.closed?window.opener.top:null,n=s&&s.view&&(s.view.nocats||s.view);n&&n.viewRefresh&&n.viewRefresh(e.unid)}window.close()}else{var r=a.split(">this")[0];window.location.href=["/newdoc?"+e.dbAlias,encodeURIComponent(r),e.dbAlias,e.unid].join("&")}},a.render=function(e){return console.log("Sova.online 5.0, React",u.a.version),window.jsDoc?u.a.createElement(pe,{closeDoc:a.closeDoc,urlForm:window.jsDoc.urlForm,fieldValues:window.jsDoc.data?Object(n.a)({},window.jsDoc.data):null,dbAlias:window.jsDoc.dbAlias,cssJsUrl:window.jsDoc.cssJsUrl,unid:window.jsDoc.unid,rsMode:window.jsDoc.rsMode,printList:window.jsDoc.printList,newForm:window.jsDoc.newForm,userName:(window.jsDoc.userName||"").split("::")[0],owlDebug:window.owlDebug}):u.a.createElement("h2",null,"\u0414\u043e\u043a\u0443\u043c\u0435\u043d\u0442 \u043d\u0435\u0434\u043e\u0441\u0442\u0443\u043f\u0435\u043d")},a}return Object(l.a)(t,e),t}(u.a.Component);p.a.render(u.a.createElement(he,null),document.getElementById("root"))}],[[12,1,2]]]);
//# sourceMappingURL=main.153159f1.chunk.js.map